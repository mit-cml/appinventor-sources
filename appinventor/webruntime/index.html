<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Screen1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"/>
    <script>
      function yailNumberToString(n) {
        if (Number.isFinite(n)) {
          if (n == Math.round(n)) {
            return n.toString();
          } else {
            // TODO(ewpatton): Match the Java version here
            return n.toString();
          }
        } else {
          return n < 0 ? "-infinity" : "+infinity";
        }
      }
       // Send ready message to App Inventor (opener)
      window.onload = () => {
        if (window.opener) {
          window.opener.postMessage("ready", "http://localhost:8888");
        }
      };

      // Receive messages from App Inventor
      window.addEventListener("message", async (event) => {
        if (event.origin !== "http://localhost:8888") return;
        const data = event.data;
        
        if (data.type === "sendToEmulator") { // Emulator will display the message and echo it in app inventor
          console.log("App Inventor said: ", data.payload);
          window.opener.postMessage({type : "response", payload : "Emulator received: " + data.payload}, "http://localhost:8888");
        } else if (data.type === "response") { // Same as sendToEmulator but without echo
          console.log("App Inventor said: ", data.payload);
        } else if (data.type === "eval") {
          var result = await evalScheme(data.payload);
          window.opener.postMessage({type : "response", payload: "Answer is: " + result}, "http://localhost:8888");
        }
      });

    </script>
    <script src="build/runtime.js" type="text/javascript"></script>
    <script>
      //evalScheme('(define-macro (add-component container component-type component-name . init-form) `(begin (define ,component-name #!void) (add-component-within-repl \',container \',component-type \',component-name (lambda () ,@init-form))))');
      //evalScheme("(define-macro (add-component container component-type component-name) `(list ',container ',component-type ',component-name))");
      /*
      evalScheme(`(define-syntax unless
    (syntax-rules ()
      ((unless test body ...)
       (if test #f (begin body ...)))))`);
       */
      /*
      evalScheme(`(define-syntax add-component
  (syntax-rules ()
    ((_ container component-type component-name)
     (begin
       (define component-name #!void)
           (add-component-within-repl 'container
                                      'component-type
                                      'component-name
                                      #f)))))))`);
       */
    </script>
    <script src="build/web/webemu/webemu.nocache.js" type="text/javascript"></script>
    <script>
      //evalScheme("(init-runtime)")
    </script>
    <style>
      @font-face {
        font-family: "Roboto";
        src: url("war/static/fonts/Roboto-Regular.ttf") format("truetype");
      }
      html, body { font-family: Roboto, Helvetica, Arial, sans-serif; width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; font-size: 14pt; }
      button { font-family: Roboto, Helvetica, Arial, sans-serif; font-size: 14pt; padding: 4px 8px; }
      #activity { display: flex; width: 100%; height: 100%; }
      #activity>div { width: 100%; height: 100%; }
      .fillViewport { width: 100%; height: 100%; position: relative; }
      .ContentView { display: flex; width: 100%; height: 100%; padding-top: 3.4rem; box-sizing: border-box; }
    </style>
  </head>
  <body>
    <div id="activity"></div>
  </body>
</html>
