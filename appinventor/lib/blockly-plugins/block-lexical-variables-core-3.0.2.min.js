/*! For license information please see index.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],t);else{var n="object"==typeof exports?t(require("blockly/core")):t(e.Blockly);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,(e=>(()=>{"use strict";var t={573:t=>{t.exports=e}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{r.r(o),r.d(o,{LexicalVariablesPlugin:()=>Y});var e={};r.r(e),r.d(e,{GLOBAL_KEYWORD:()=>c,handlerParameterPrefix:()=>_,localNamePrefix:()=>d,loopParameterPrefix:()=>p,loopRangeParameterPrefix:()=>h,menuSeparator:()=>g,possiblyPrefixGeneratedVarName:()=>E,possiblyPrefixMenuNameWith:()=>A,prefixGlobalMenuName:()=>R,prefixSeparator:()=>f,procedureParameterPrefix:()=>u,showPrefixToUser:()=>a,unprefixName:()=>L,usePrefixInCode:()=>l});const t=document.createElement("style");document.head.appendChild(t);var n=r(573);n.Msg.LANG_VARIABLES_GLOBAL_DECLARATION_TITLE_INIT="initialize global",n.Msg.LANG_VARIABLES_GLOBAL_DECLARATION_NAME="name",n.Msg.LANG_VARIABLES_GLOBAL_DECLARATION_TO="to",n.Msg.LANG_VARIABLES_GLOBAL_DECLARATION_COLLAPSED_TEXT="global",n.Msg.LANG_VARIABLES_GLOBAL_DECLARATION_TOOLTIP="Creates a global variable and gives it the value of the attached blocks.",n.Msg.LANG_VARIABLES_GLOBAL_PREFIX="global",n.Msg.LANG_VARIABLES_GET_TITLE_GET="get",n.Msg.LANG_VARIABLES_GET_COLLAPSED_TEXT="get",n.Msg.LANG_VARIABLES_GET_TOOLTIP="Returns the value of this variable.",n.Msg.LANG_VARIABLES_SET_TITLE_SET="set",n.Msg.LANG_VARIABLES_SET_TITLE_TO="to",n.Msg.LANG_VARIABLES_SET_COLLAPSED_TEXT="set",n.Msg.LANG_VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",n.Msg.LANG_VARIABLES_VARIABLE=" variable",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_TITLE_INIT="initialize local",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_DEFAULT_NAME="name",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_INPUT_TO="to",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_IN_DO="in",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_COLLAPSED_TEXT="local",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_TOOLTIP="Allows you to create variables that are only accessible in the do part of this block.",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_TRANSLATED_NAME="initialize local in do",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_EXPRESSION_IN_RETURN="in",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_EXPRESSION_COLLAPSED_TEXT="local",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_EXPRESSION_TOOLTIP="Allows you to create variables that are only accessible in the return part of this block.",n.Msg.LANG_VARIABLES_LOCAL_DECLARATION_EXPRESSION_TRANSLATED_NAME="initialize local in return",n.Msg.LANG_VARIABLES_LOCAL_MUTATOR_CONTAINER_TITLE_LOCAL_NAMES="local names",n.Msg.LANG_VARIABLES_LOCAL_MUTATOR_CONTAINER_TOOLTIP="",n.Msg.LANG_VARIABLES_LOCAL_MUTATOR_ARG_TITLE_NAME="name",n.Msg.LANG_VARIABLES_LOCAL_MUTATOR_ARG_DEFAULT_VARIABLE="x",n.Msg.LANG_PROCEDURES_DEFNORETURN_DEFINE="to",n.Msg.LANG_PROCEDURES_DEFNORETURN_PROCEDURE="procedure",n.Msg.LANG_PROCEDURES_DEFNORETURN_DO="do",n.Msg.LANG_PROCEDURES_DEFNORETURN_COLLAPSED_PREFIX="to ",n.Msg.LANG_PROCEDURES_DEFNORETURN_TOOLTIP="A procedure that does not return a value.",n.Msg.LANG_PROCEDURES_DOTHENRETURN_THEN_RETURN="result",n.Msg.LANG_PROCEDURES_DOTHENRETURN_DO="do",n.Msg.LANG_PROCEDURES_DOTHENRETURN_RETURN="result",n.Msg.LANG_PROCEDURES_DOTHENRETURN_TOOLTIP="Runs the blocks in 'do' and returns a statement. Useful if you need to run a procedure before returning a value to a variable.",n.Msg.LANG_PROCEDURES_DOTHENRETURN_COLLAPSED_TEXT="do/result",n.Msg.LANG_PROCEDURES_DEFRETURN_DEFINE="to",n.Msg.LANG_PROCEDURES_DEFRETURN_PROCEDURE="procedure",n.Msg.LANG_PROCEDURES_DEFRETURN_RETURN="result",n.Msg.LANG_PROCEDURES_DEFRETURN_COLLAPSED_PREFIX="to ",n.Msg.LANG_PROCEDURES_DEFRETURN_TOOLTIP="A procedure returning a result value.",n.Msg.LANG_PROCEDURES_DEF_DUPLICATE_WARNING="Warning:\nThis procedure has\nduplicate inputs.",n.Msg.LANG_PROCEDURES_CALLNORETURN_CALL="call ",n.Msg.LANG_PROCEDURES_CALLNORETURN_PROCEDURE="procedure",n.Msg.LANG_PROCEDURES_CALLNORETURN_COLLAPSED_PREFIX="call ",n.Msg.LANG_PROCEDURES_CALLNORETURN_TOOLTIP="Call a procedure with no return value.",n.Msg.LANG_PROCEDURES_CALLNORETURN_TRANSLATED_NAME="call no return",n.Msg.LANG_PROCEDURES_CALLRETURN_CALL="call ",n.Msg.LANG_PROCEDURES_CALLRETURN_PROCEDURE="procedure",n.Msg.LANG_PROCEDURES_CALLRETURN_COLLAPSED_PREFIX="call ",n.Msg.LANG_PROCEDURES_CALLRETURN_TOOLTIP="Call a procedure with a return value.",n.Msg.LANG_PROCEDURES_CALLRETURN_TRANSLATED_NAME="call return",n.Msg.LANG_PROCEDURES_MUTATORCONTAINER_TITLE="inputs",n.Msg.LANG_PROCEDURES_MUTATORARG_TITLE="input:",n.Msg.LANG_PROCEDURES_HIGHLIGHT_DEF="Highlight Procedure",n.Msg.LANG_PROCEDURES_MUTATORCONTAINER_TOOLTIP="",n.Msg.LANG_PROCEDURES_MUTATORARG_TOOLTIP="",n.Msg.LANG_CONTROLS_FOR_INPUT_WITH="count with",n.Msg.LANG_CONTROLS_FOR_INPUT_VAR="x",n.Msg.LANG_CONTROLS_FOR_INPUT_FROM="from",n.Msg.LANG_CONTROLS_FOR_INPUT_TO="to",n.Msg.LANG_CONTROLS_FOR_INPUT_DO="do",n.Msg.LANG_CONTROLS_FOR_TOOLTIP="Count from a start number to an end number.\nFor each count, set the current count number to\nvariable '%1', and then do some statements.",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_ITEM="for each",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_VAR="number",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_START="from",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_END="to",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_STEP="by",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_DO="do",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_COLLAPSED_TEXT="for number in range",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_COLLAPSED_PREFIX="for",n.Msg.LANG_CONTROLS_FORRANGE_INPUT_COLLAPSED_SUFFIX=" in range",n.Msg.LANG_CONTROLS_FORRANGE_TOOLTIP="Runs the blocks in the 'do' section for each numeric value in the range from start to end, stepping the value each time.  Use the given variable name to refer to the current value.",n.Msg.LANG_CONTROLS_FOREACH_INPUT_ITEM="for each",n.Msg.LANG_CONTROLS_FOREACH_INPUT_VAR="item",n.Msg.LANG_CONTROLS_FOREACH_INPUT_INLIST="in list",n.Msg.LANG_CONTROLS_FOREACH_INPUT_DO="do",n.Msg.LANG_CONTROLS_FOREACH_INPUT_COLLAPSED_TEXT="for item in list",n.Msg.LANG_CONTROLS_FOREACH_INPUT_COLLAPSED_PREFIX="for ",n.Msg.LANG_CONTROLS_FOREACH_INPUT_COLLAPSED_SUFFIX=" in list",n.Msg.LANG_CONTROLS_FOREACH_TOOLTIP="Runs the blocks in the 'do'  section for each item in the list.  Use the given variable name to refer to the current list item.",n.Msg.LANG_CONTROLS_FOREACH_DICT_INPUT="for each %1 with %2 in dictionary %3",n.Msg.LANG_CONTROLS_FOREACH_DICT_INPUT_DO="do",n.Msg.LANG_CONTROLS_FOREACH_DICT_INPUT_KEY="key",n.Msg.LANG_CONTROLS_FOREACH_DICT_INPUT_VALUE="value",n.Msg.LANG_CONTROLS_FOREACH_DICT_TITLE="for each in dictionary",n.Msg.LANG_CONTROLS_FOREACH_DICT_TOOLTIP="Runs the blocks in the 'do' section for each key-value entry in the dictionary. Use the given variable names to refer to the key/value of the current dictionary item.",n.Msg.ERROR_SELECT_VALID_ITEM_FROM_DROPDOWN="Select a valid item in the drop down.",n.Msg.ERROR_BLOCK_CANNOT_BE_IN_DEFINITION="This block cannot be in a definition",n.Msg.HORIZONTAL_PARAMETERS="Arrange Parameters Horizontally",n.Msg.VERTICAL_PARAMETERS="Arrange Parameters Vertically",n.Msg.LANG_CONTROLS_DO_THEN_RETURN_INPUT_DO="do",n.Msg.LANG_CONTROLS_DO_THEN_RETURN_INPUT_RETURN="result",n.Msg.LANG_CONTROLS_DO_THEN_RETURN_TOOLTIP="Runs the blocks in 'do' and returns a statement. Useful if you need to run a procedure before returning a value to a variable.",n.Msg.LANG_CONTROLS_DO_THEN_RETURN_COLLAPSED_TEXT="do/result",n.Msg.LANG_CONTROLS_DO_THEN_RETURN_TITLE="do result",n.Msg.PROCEDURES_DEFNORETURN_PROCEDURE=n.Msg.LANG_PROCEDURES_DEFNORETURN_PROCEDURE,n.Msg.PROCEDURES_DEFRETURN_PROCEDURE=n.Msg.LANG_PROCEDURES_DEFRETURN_PROCEDURE;class s{checkErrors(e){if(e.getSvgRoot&&!e.getSvgRoot()||e.readOnly)return e.hasWarning&&(e.hasWarning=!1),void(e.hasError&&(e.hasError=!1));e.errors||(e.errors=[]),e.warnings||(e.warnings=[]);const t=e.errors,n=e.warnings;for(let n=0;n<t.length;n++)if(t[n].func&&t[n].func.call(this,e,t[n]))return e.hasError||(e.hasError=!0),void(e.hasWarning&&(e.hasWarning=!1));e.hasError&&(e.hasError=!1);for(let t=0;t<n.length;t++)if(n[t].func&&n[t].func.call(this,e,n[t]))return void(e.hasWarning||(e.hasWarning=!0));e.warning&&e.setWarningText(null),e.hasWarning&&(e.hasWarning=!1)}setError(e,t){e.setWarningText(t)}setWarning(e,t){e.setWarningText(t)}}class i{static checkIsInDefinition(e){if("global_declaration"===e.getRootBlock().type){const t=n.Msg.ERROR_BLOCK_CANNOT_BE_IN_DEFINITION;return e.workspace.getWarningHandler().setError(e,t),!0}return!1}static checkDropDownContainsValidValue(e,t){if(e.workspace.isDragging&&e.workspace.isDragging())return!1;for(let r=0;r<t.dropDowns.length;r++){const o=e.getField(t.dropDowns[r]),s=o.menuGenerator_(),i=o.getText(),a=o.getValue();let l=!1;o.updateMutation&&o.updateMutation();for(let e=0;e<s.length;e++)if(s[e][1]===a&&" "!==a){l=!0,s[e][0]!==i&&o.setValue(s[e][0]);break}if(!l){const t=n.Msg.ERROR_SELECT_VALID_ITEM_FROM_DROPDOWN;return e.workspace.getWarningHandler().setError(e,t),!0}}return!1}}const a=!1,l=!1,c="global",u="input",_="input",d="local",p="item",h="counter",g=" ",f="_",A=function(e){return function(t){return(a?e+g:"")+t}},R=function(e){return n.Msg.LANG_VARIABLES_GLOBAL_PREFIX+g+e},L=function(e){if(0===e.indexOf(n.Msg.LANG_VARIABLES_GLOBAL_PREFIX+g))return[n.Msg.LANG_VARIABLES_GLOBAL_PREFIX,e.substring(n.Msg.LANG_VARIABLES_GLOBAL_PREFIX.length+g.length)];if(0===e.indexOf(c+g))return[c,e.substring(6+g.length)];if(a){const t=[u,_,d,p,h];for(let n=0;n<t.length;n++)if(0===e.indexOf(t[n]))return[t[n],e.substring(t[n].length+g.length)];return["",e]}return["",e]},E=function(e){return function(t){return(l?e+f:"")+t}},m=function(e){e||(e=[]),this.elements={};for(let t,n=0;t=e[n];n++)this.elements[t]=!0};m.prototype.isMember=function(e){return!!this.elements[e]},m.prototype.isEmpty=function(){for(let e in this.elements)return!1;return!0},m.prototype.size=function(){let e=0;for(let t in this.elements)e++;return e},m.prototype.toList=function(){const e=[];for(let t in this.elements)e.push(t);return e.sort()},m.prototype.toString=function(){return"NameSet{"+this.toList().join(",")+"}"},m.prototype.copy=function(){const e=new m;for(let t in this.elements)e.insert(t);return e},m.prototype.mirror=function(e){let t;for(t in this.elements)delete this.elements[t];for(t in e.elements)this.elements[t]=!0},m.prototype.insert=function(e){this.elements[e]=!0},m.prototype.deleteName=function(e){delete this.elements[e]},m.prototype.unite=function(e){for(let t in e.elements)this.elements[t]=!0},m.prototype.intersect=function(e){for(let t in this.elements)e.elements[t]||delete this.elements[t]},m.prototype.subtract=function(e){for(let t in this.elements)e.elements[t]&&delete this.elements[t]},m.prototype.rename=function(e){this.mirror(this.renamed(e))},m.prototype.insertion=function(e){const t=this.copy();return t.insert(e),t},m.prototype.deletion=function(e){const t=this.copy();return t.deleteName(e),t},m.prototype.union=function(e){const t=this.copy();return t.unite(e),t},m.prototype.intersection=function(e){const t=this.copy();return t.intersect(e),t},m.prototype.difference=function(e){const t=this.copy();return t.subtract(e),t},m.prototype.renamed=function(e){const t=new m;for(let n in this.elements){const r=e.apply(n);r?t.insert(r):t.insert(n)}return t},m.unionAll=function(e){const t=new m;for(let n,r=0;n=e[r];r++)t.unite(n);return t},m.intersectAll=function(e){if(0===e.length)return new m;{const t=e[0];for(let n,r=1;n=e[r];r++)t.intersect(n);return t}};const N=function(e,t){if(this.bindings={},N.isAllStringsArray(t)&&N.isAllStringsArray(e)&&e.length===t.length)for(var n=0;n<e.length;n++)this.bindings[e[n]]=t[n];else if(!t&&N.isBindingsObject(e))for(var r in this.bindings={},e)this.bindings[r]=e[r]};N.isAllStringsArray=function(e){if("object"!=typeof e||!e.length)return!1;for(var t=0;t<e.length;t++)if("string"!=typeof e[t])return!1;return!0},N.isBindingsObject=function(e){if("object"!=typeof e)return!1;for(var t in e)if("string"!=typeof t||(e[t],0))return!1;return!0},N.simpleSubstitution=function(e,t){var n={};return n[e]=t,new N(n)},N.prototype.apply=function(e){return this.bindings[e]||e},N.prototype.map=function(e){const t=this;return e.map((function(e){return t.apply(e)}))},N.prototype.toString=function(){var e=[];for(var t in this.bindings)e.push(t+":"+this.bindings[t]);return"Substitution{"+e.sort().join(",")+"}"},N.prototype.copy=function(){var e=new N;for(var t in this.bindings)e.bindings[t]=this.bindings[t];return e},N.prototype.restrictDomain=function(e){for(var t=new N,n=0;n<e.length;n++){var r=this.bindings[e[n]];r&&(t.bindings[e[n]]=r)}return t},N.prototype.remove=function(e){var t=new N;for(var n in this.bindings)-1==e.indexOf(n)&&(t.bindings[n]=this.bindings[n]);return t},N.prototype.extend=function(e){var t=this.copy();for(var n in e.bindings)t.bindings[n]=e.bindings[n];return t},N.prototype.domain=function(){var e=[];for(var t in this.bindings)e.push(t);return e.sort()},N.prototype.getBindings=function(){var e={};for(var t in this.bindings)e[t]=this.bindings[t];return e};class T extends n.FieldDropdown{constructor(e,t){super(T.dropdownCreate),this.varname=e,this.translatedName=t,e?this.doValueUpdate_(e):this.doValueUpdate_(n.Variables.generateUniqueName())}setTranslatedValue(e,t){this.varname=t,this.translatedName=e,this.getOptions(!1),this.setValue(t),this.forceRerender()}}T.prototype.doClassValidation_=function(e){return e},T.prototype.getBlock=function(){return this.block_},T.prototype.setBlock=function(e){this.block_=e},T.getGlobalNames=function(e){const t=n.common.getMainWorkspace(),r=t.getRootWorkspace()||t;if(r&&r.getWarningHandler&&r.getWarningHandler().cacheGlobalNames)return r.getWarningHandler().cachedGlobalNames;const o=[];if(r&&!r.isFlyout){let t=[];t=r.getTopBlocks();for(let n=0;n<t.length;n++){const r=t[n];r.getGlobalNames&&r!=e&&o.push(...r.getGlobalNames())}}return o},T.prototype.getNamesInScope=function(){return T.getNamesInScope(this.block_)},T.getNamesInScope=function(e){let t=T.getGlobalNames();t=y.sortAndRemoveDuplicates(t),t=t.map((function(e){return[R(e),"global "+e]}));const n=T.getLexicalNamesInScope(e);return t.concat(n)},T.getLexicalNamesInScope=function(e){let t=[];const n={};let r,o;function s(e,t,r,o){const s=o||e;let i;l?i=A(r)(s):(n[s]||(n[s]=r),i=A(n[s])(s)),t.push([i,e])}if(o=e,o&&(r=o.getParent(),r))for(;r;)r.withLexicalVarsAndPrefix&&r.withLexicalVarsAndPrefix(o,((e,n,r)=>{s(e,t,n,r)})),o=r,r=r.getParent();return y.sortAndRemoveDuplicates(t)},T.dropdownCreate=function(){const e=this.getNamesInScope();return e.length>0?e:this.translatedName?[[this.translatedName,this.varname]]:[[" "," "]]},T.prototype.doValueUpdate_=function(e){if(Object.getPrototypeOf(n.FieldDropdown).prototype.doValueUpdate_.call(this,e),e&&" "!==e){const t=e.split(" ");2==t.length&&"global"!==t[0]&&(e="global "+t[1])}this.value_=e;const t=this.getOptions(!0,[[(r=e,r.startsWith("global ")?r.replace("global ",n.Msg.LANG_VARIABLES_GLOBAL_PREFIX+" "):r),e]]);var r;for(let e,n=0;e=t[n];n++)if(e[1]==this.value_){this.selectedOption=e;break}this.updateMutation(),this.forceRerender()},T.prototype.updateMutation=function(){const e=this.getText();if(this.sourceBlock_&&this.sourceBlock_.getParent()){if(this.sourceBlock_.eventparam=void 0,0===e.indexOf(n.Msg.LANG_VARIABLES_GLOBAL_PREFIX+" "))return this.sourceBlock_.eventparam=null,this.translatedName=void 0,void(this.varname=void 0);let t,r=this.sourceBlock_.getParent();for(;r;){const n=r.declaredVariables?r.declaredVariables():[];for(t=0;t<n.length;t++)if(n[t]==e){if("component_event"==r.type){const e=r.getParameters()[t].name;return this.sourceBlock_.eventparam=e,this.translatedName=n[t],void(this.varname=e)}return this.sourceBlock_.eventparam=null,this.translatedName=void 0,void(this.varname=void 0)}r=r.getParent()}}},T.prototype.getOptions=function(e,t){Array.isArray(e)&&(t=e);const n=t||[];return this.isOptionListDynamic()?(this.generatedOptions_&&e||(this.generatedOptions_=this.menuGenerator_.call(this).concat(n),O(this.generatedOptions_)),this.generatedOptions_.concat(n)):this.menuGenerator_};const O=function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let n=0;n<e.length;++n){const r=e[n];Array.isArray(r)?"string"!=typeof r[1]?(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option id must be a string. Found "+r[1]+" in: ",r)):r[0]&&"string"!=typeof r[0]&&"string"!=typeof r[0].src&&(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option must have a string label or image description. Found"+r[0]+" in: ",r)):(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option must be an array. Found: ",r))}if(t)throw TypeError("Found invalid FieldDropdown options.")};T.dropdownChange=function(e){if(e){this.doValueUpdate_(e);const t=this.sourceBlock_.workspace.getTopWorkspace();t.getWarningHandler&&t.getWarningHandler().checkErrors(this.sourceBlock_)}},T.nameNotIn=function(e,t){const n=T.prefixSuffix(e),r=n[0],o=n[1];let s=!1,i=!1;const a=[];for(let e=0;e<t.length;e++){const n=T.prefixSuffix(t[e]),l=n[0],c=n[1];l===r&&(c===o&&(i=!0),""===c?s=!0:a.push(c))}if(i){if(s){const e=a.map((function(e,t,n){return parseInt(e,10)}));e.sort((function(e,t){return e-t}));let t=2,n=0;for(;n<e.length;){if(t<e[n])return r+t;t==e[n]?(t++,n++):n++}return r+t}return r}return e},T.prefixSuffix=function(e){const t=e.match(/^(.*?)(\d+)$/);return t?[t[1],t[2]]:[e,""]},T.fromJson=function(e){const t=n.utils.replaceMessageReferences(e.name);return new T(t)},n.fieldRegistry.register("field_lexical_variable",T);const y={renameGlobal:function(e){const t=this.value_;e=y.makeLegalIdentifier(e),this.sourceBlock_.getField("NAME").doValueUpdate_(e);const r=T.getGlobalNames(this.sourceBlock_);if(e=T.nameNotIn(e,r),this.sourceBlock_.rendered&&n.common.getMainWorkspace()){const r=n.common.getMainWorkspace().getAllBlocks();for(let o=0;o<r.length;o++){const s=r[o],i=s.renameLexicalVar;i&&i.call(s,c+g+t,c+g+e,n.Msg.LANG_VARIABLES_GLOBAL_PREFIX+g+t,n.Msg.LANG_VARIABLES_GLOBAL_PREFIX+g+e)}}return e},renameParam:function(e){const t=this.htmlInput_,n=this.getValue()||t&&t.defaultValue||this.getText();return e=y.makeLegalIdentifier(e),y.renameParamFromTo(this.sourceBlock_,n,e,!1)},renameParamFromTo:function(e,t,n,r){return e.mustNotRenameCapturables?y.renameParamWithoutRenamingCapturables(e,t,n,[]):r?(y.renameParamRenamingCapturables(e,t,n),n):y.renameParamWithoutRenamingCapturables(e,t,n,[])},renameParamRenamingCapturables:function(e,t,n){if(n!==t){const r=e.declaredNames?e.declaredNames():[];if(-1==r.indexOf(t))throw Error("LexicalVariable.renamingCapturables: oldName "+t+" is not in declarations {"+r.join(",")+"}");const o=[];T.getNamesInScope(e).map((function(e){e[0]==e[1]?o.push(e[0]):o.push(e[0],e[1])}));const s=r.concat(o);if(-1!=s.indexOf(n))throw Error("LexicalVariable.renameParamRenamingCapturables: newName "+n+" is in existing declarations {"+s.join(",")+"}");if(!e.renameBound)throw Error("LexicalVariable.renameParamRenamingCapturables: block "+e.type+" is not a declaration block.");{const r=N.simpleSubstitution(t,n),o=new N;e.renameBound(r,o)}}},renameFree:function(e,t){e&&(e.renameFree?e.renameFree(t):e.getChildren().map((function(e){y.renameFree(e,t)})))},freeVariables:function(e){let t=[];if(e)if(e.freeVariables)t=e.freeVariables();else{const n=e.getChildren().map((function(e){return y.freeVariables(e)}));t=m.unionAll(n)}else t=new m;return t},renameParamWithoutRenamingCapturables:function(e,t,n,r){if(t===n)return t;let o="";a&&(o=this.lexicalVarPrefix);const s=y.renameParamWithoutRenamingCapturablesInfo(e,t,o),i=s[0],l=s[1];let c=[];if(e.declaredNames){c=e.declaredNames();const o=c.indexOf(t);if(-1!=o&&c.splice(o,1),-1!=r.indexOf(n)){const e=c.indexOf(n);-1!=e&&c.splice(e,1)}}const u=y.sortAndRemoveDuplicates(l.concat(c));if((n=T.nameNotIn(n,u))!==t&&-1==c.indexOf(t))for(let e=0;e<i.length;e++){const r=i[e],s=r.renameLexicalVar;s&&s.call(r,A(o)(t),A(o)(n))}return n},renameParamWithoutRenamingCapturablesInfo:function(e,t,n){let r=[];e.blocksInScope&&(r=e.blocksInScope());const o=r.map((function(e){return y.referenceResult(e,t,n,[])}));let s=[],i=[];for(let e=0;e<o.length;e++)s=s.concat(o[e][0]),i=i.concat(o[e][1]);return i=y.sortAndRemoveDuplicates(i),[s,i]},checkIdentifier:function(e){const t=e.trim().replace(/[\s\xa0]+/g,"_"),n=new RegExp("^[^-0-9!&%^/>=<`'\"#:;,\\\\*+.()|{}[\\] ][^-!&%^/>=<'\"#:;,\\\\*+.()|{}[\\] ]*$");return{isLegal:0==t.search(n),transformed:t}},makeLegalIdentifier:function(e){const t=y.checkIdentifier(e);return t.isLegal?t.transformed:""===t.transformed?"_":"name"},referenceResult:function(e,t,n,r){if(!e)return[[],[]];const o=e.referenceResults?e.referenceResults(t,n,r):e.getChildren().map((function(e){return y.referenceResult(e,t,n,r)}));let s=[],i=[];for(let e=0;e<o.length;e++)s=s.concat(o[e][0]),i=i.concat(o[e][1]);return[s,i]},sortAndRemoveDuplicates:function(e){const t=e.sort(((e,t)=>{if("string"==typeof e&&"string"==typeof t)return e.localeCompare(t);if(Array.isArray(e)&&Array.isArray(t))return e[1].localeCompare(t[1]);throw Error("LexicalVariable.sortAndRemoveDuplicates: arguments must be strings or arrays of strings")})),n=[];if(e.length>=1){let e=t[0];n.push(e);for(let r=1;r<t.length;r++){let o=!1;const s=t[r];o=Array.isArray(s)&&Array.isArray(e)?0===s[1].localeCompare(e[1]):s===e,o||(e=s,n.push(e))}}return n},getNextTargetBlock:function(e){return e&&e.nextConnection&&e.nextConnection.targetBlock()?e.nextConnection.targetBlock():null},stringListsEqual:function(e,t){const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}},I=["",""],P=function(e,t){const r=(t||n.common.getMainWorkspace()).getTopBlocks(),o=[I];for(let t=0;t<r.length;t++){const n=r[t].getFieldValue("NAME");"procedures_defnoreturn"!=r[t].type||e?"procedures_defreturn"==r[t].type&&e&&o.push([n,n]):o.push([n,n])}return o.length>1&&o.splice(0,1),o},S=function(e){if(this.sourceBlock_&&this.sourceBlock_.isInFlyout)return e;const t=this.oldName_||this.getValue(),n=e;e=y.makeLegalIdentifier(e);const r=function(e){const t=e.workspace.getTopBlocks(!1),n=[];for(let r=0;r<t.length;r++)"procedures_defnoreturn"!==t[r].type&&"procedures_defreturn"!==t[r].type||t[r]!==e&&n.push(t[r]);return n}(this.sourceBlock_).map((function(e){return e.getFieldValue("NAME")}));(e=T.nameNotIn(e,r))!==n&&this.doValueUpdate_(e);const o=this.sourceBlock_.workspace.getAllBlocks();for(let n=0;n<o.length;n++){const r=o[n].renameProcedure;r&&r.call(o[n],t,e)}return this.oldName_=e,e},C=function(e){this.workspace_=e,this.procedures_={},this.returnProcedures_={},this.voidProcedures_={},this.length=0,this.returnProcedures=0,this.voidProcedures=0};C.defaultValue=["","none"],C.prototype.getNames=function(e){return P(e,this.workspace_).map((function(e){return e[0]}))},C.prototype.getMenuItems=function(e){return P(e,this.workspace_)},C.prototype.getDeclarationBlocks=function(e){return n.utils.object.values(e?this.returnProcedures_:this.voidProcedures_)},C.prototype.getDeclarationsBlocksExcept=function(e){const t=[];return n.utils.values(this.procedures_).forEach((function(n){n!==e&&t.push(n)})),t},C.prototype.getAllDeclarationNames=function(){return n.utils.values(this.procedures_).map((function(e){return e.getFieldValue("NAME")}))},C.prototype.addProcedure=function(e,t){if("procedures_defnoreturn"!=t.type&&"procedures_defreturn"!=t.type)return console.warn("Attempt to addProcedure with block type "+t.type),!1;const n=t.id;return!(n in this.procedures_)&&(this.procedures_[n]=t,this.length++,"procedures_defnoreturn"==t.type?(this.voidProcedures_[n]=t,this.voidProcedures++):(this.returnProcedures_[n]=t,this.returnProcedures++),!0)},C.prototype.removeProcedure=function(e){return e in this.procedures_&&("procedures_defnoreturn"==this.procedures_[e].type?(delete this.voidProcedures_[e],this.voidProcedures--):(delete this.returnProcedures_[e],this.returnProcedures--),delete this.procedures_[e],this.length--),!0},C.prototype.renameProcedure=function(e,t,n){},C.prototype.getProcedure=function(e){return this.procedures_[e]||this.getProcedureByName(e)},C.prototype.getProcedureByName=function(e){for(const t in this.procedures_)if(this.procedures_[t].getFieldValue("NAME")===e)return this.procedures_[t]},C.prototype.clear=function(){this.procedures_={},this.returnProcedures_={},this.voidProcedures_={},this.length=0,this.returnProcedures=0,this.voidProcedures=0},n.Workspace.prototype.flydown_=n.Workspace.prototype.flydown_||null,n.Workspace.prototype.getFlydown=n.Workspace.prototype.getFlydown||function(){return this.flydown_},n.Workspace.prototype.getProcedureDatabase=n.Workspace.prototype.getProcedureDatabase||function(){return this.procedureDb_||(this.procedureDb_=new C(this)),this.procedureDb_},n.Workspace.prototype.getTopWorkspace=n.Workspace.prototype.getTopWorkspace||function(){let e=this;for(;e.targetWorkspace;)e=e.targetWorkspace;return e},n.Workspace.prototype.getWarningHandler=n.Workspace.prototype.getWarningHandler||function(){return this.warningHandler_||(this.warningHandler_=new s),this.warningHandler_},n.WorkspaceSvg.prototype.flydown_=n.WorkspaceSvg.prototype.flydown_||null,n.WorkspaceSvg.prototype.getFlydown=n.WorkspaceSvg.prototype.getFlydown||function(){return this.flydown_},n.WorkspaceSvg.prototype.getProcedureDatabase=n.WorkspaceSvg.prototype.getProcedureDatabase||function(){return this.procedureDb_||(this.procedureDb_=new C(this)),this.procedureDb_},n.WorkspaceSvg.prototype.getTopWorkspace=n.WorkspaceSvg.prototype.getTopWorkspace||function(){let e=this;for(;e.targetWorkspace;)e=e.targetWorkspace;return e},n.WorkspaceSvg.prototype.getWarningHandler=n.WorkspaceSvg.prototype.getWarningHandler||function(){return s};class b extends n.inputs.ValueInput{constructor(e,t){super(e,t),this.connection=this.makeConnection(n.ConnectionType.INPUT_VALUE),this.type=n.inputTypes.VALUE}}n.registry.register(n.registry.Type.INPUT,"indented_input",b);class k extends n.FieldTextInput{static timeout=500;static showPid_=0;static openFieldFlydown_=null;static DISPLAY_BELOW="BELOW";static DISPLAY_RIGHT="RIGHT";static DISPLAY_LOCATION=k.DISPLAY_BELOW;constructor(e,t,n,r){super(e,r),this.EDITABLE=t,this.displayLocation=n||k.DISPLAY_RIGHT}showEditor_(){this.EDITABLE&&(k.showPid_&&(clearTimeout(k.showPid_),k.showPid_=0,n.common.getMainWorkspace().hideChaff()),super.showEditor_())}init(e){super.init(e),n.utils.dom.addClass(this.fieldGroup_,this.fieldCSSClassName),this.mouseOverWrapper_=n.browserEvents.bind(this.fieldGroup_,"mouseover",this,this.onMouseOver_),this.mouseOutWrapper_=n.browserEvents.bind(this.fieldGroup_,"mouseout",this,this.onMouseOut_)}}k.prototype.fieldCSSClassName="blocklyFieldFlydownField",k.prototype.flyoutCSSClassName="blocklyFieldFlydownFlydown",k.prototype.onMouseOver_=function(e){this.sourceBlock_.isInFlyout||0!=k.showPid_||(k.showPid_=window.setTimeout(this.showFlydownMaker_(),k.timeout)),e.stopPropagation()},k.prototype.onMouseOut_=function(e){window.clearTimeout(k.showPid_),k.showPid_=0,e.stopPropagation()},k.prototype.showFlydownMaker_=function(){const e=this;return function(){if(0!==k.showPid_&&!e.getSourceBlock().workspace.isDragging()&&!this.htmlInput_)try{e.showFlydown_()}catch(e){console.error("Failed to show flydown",e)}k.showPid_=0}},k.prototype.showFlydown_=function(){n.common.getMainWorkspace().hideChaff();const e=n.common.getMainWorkspace().getFlydown();n.common.getMainWorkspace().getParentSvg().appendChild(e.svgGroup_);const t=e.targetWorkspace.scale;e.workspace_.setScale(t),e.setCSSClass(this.flyoutCSSClassName);const r=this.flydownBlocksXML_(),o=void 0!==(s=n.utils.xml.textToDom(r)).children?s.children:Array.prototype.filter.call(s.childNodes,(function(e){return e.nodeType==n.utils.dom.NodeType.ELEMENT_NODE}));var s;const i=n.common.getMainWorkspace().getSvgXY(this.borderRect_),a=this.borderRect_.getBBox();this.displayLocation===k.DISPLAY_BELOW?i.y+=a.height*t:i.x+=a.width*t,e.field_=this,e.showAt(o,i.x,i.y),k.openFieldFlydown_=this},k.hide=function(){window.clearTimeout(k.showPid_);const e=n.common.getMainWorkspace().getFlydown();e&&e.hide()},k.prototype.onHtmlInputChange_=function(e){const t=this.htmlInput_,r=t.value;if(r!==t.oldValue_){t.oldValue_=r;let e=!0;this.sourceBlock_&&(e=function(e,t){const n=e.doClassValidation_(t);if(null===n)return null;void 0!==n&&(t=n);const r=e.getValidator();if(r){const n=r.call(e,t);if(null===n)return null;void 0!==n&&(t=n)}return t}(this,t.value)),null===e?n.utils.dom.addClass(t,"blocklyInvalidInput"):(n.utils.dom.removeClass(t,"blocklyInvalidInput"),this.doValueUpdate_(e))}else n.utils.userAgent.WEBKIT&&this.sourceBlock_.render();this.textContent_.nodeValue=r,this.forceRerender(),this.resizeEditor_(),n.svgResize(this.sourceBlock_.workspace)},k.prototype.dispose=function(){k.openFieldFlydown_==this&&k.hide(),n.FieldTextInput.prototype.dispose.call(this)},k.fromJson=function(e){const t=n.utils.replaceMessageReferences(e.name);return new k(t,e.is_editable)},n.fieldRegistry.register("field_flydown",k);class D extends n.VerticalFlyout{constructor(e){super(e),this.dragAngleRange_=360}}D.prototype.previousCSSClassName_="",D.prototype.VERTICAL_SEPARATION_FACTOR=1,D.prototype.createDom=function(e){return this.previousCSSClassName_=e,this.svgGroup_=n.utils.dom.createSvgElement("g",{class:e},null),this.svgBackground_=n.utils.dom.createSvgElement("path",{},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.svgGroup_},D.prototype.setCSSClass=function(e){e!==this.previousCSSClassName_&&(n.utils.dom.removeClass(this.svgGroup_,this.previousCSSClassName_),n.utils.dom.addClass(this.svgGroup_,e),this.previousCSSClassName_=e)},D.prototype.init=function(e){n.Flyout.prototype.init.call(this,e,!1),this.workspace_.setTheme(e.getTheme()),e.getComponentManager().addCapability(this.id,n.ComponentManager.Capability.AUTOHIDEABLE)},D.prototype.position=function(){},D.prototype.showAt=function(e,t,r){n.Events.disable();try{this.show(e)}finally{n.Events.enable()}const o=this.CORNER_RADIUS*this.workspace_.scale,s=this.width_-2*o,i=this.height_-2*o,a=["M 0,"+o];a.push("a",o,o,0,0,1,o,-o),a.push("h",s),a.push("a",o,o,0,0,1,o,o),a.push("v",i),a.push("a",o,o,0,0,1,-o,o),a.push("h",-s),a.push("a",o,o,0,0,1,-o,-o),a.push("z"),this.svgBackground_.setAttribute("d",a.join(" ")),this.svgGroup_.setAttribute("transform","translate("+t+", "+r+")")},D.prototype.reflow=function(){this.workspace_.scale=this.targetWorkspace.scale;const e=this.workspace_.scale;let t=0,n=0;const r=this.CORNER_RADIUS*e,o=this.workspace_.getTopBlocks(!1);for(let r,s=0;r=o[s];s++){const o=r.getHeightWidth();t=Math.max(t,o.width*e),n+=o.height*e}t+=2*r+this.tabWidth_*e;const s=this.workspace_.getRenderer().getConstants(),i=s.ADD_START_HATS?s.START_HAT_HEIGHT:0;if(n+=3*r+r*this.VERTICAL_SEPARATION_FACTOR*o.length+i*e/2,this.width_!=t){for(let n,s=0;n=o[s];s++){const o=n.getHeightWidth(),s=n.getRelativeToSurfaceXY();if(this.RTL){const o=t-r-e*(this.tabWidth_-s.x);n.moveBy(o,0),s.x+=o}n.flyoutRect_&&(n.flyoutRect_.setAttribute("width",o.width),n.flyoutRect_.setAttribute("height",o.height),n.flyoutRect_.setAttribute("x",this.RTL?s.x-o.width:s.x),n.flyoutRect_.setAttribute("y",s.y))}this.width_=t,this.height_=n}},D.prototype.onMouseMove_=function(e){},D.prototype.placeNewBlock_=function(e){const t=this.targetWorkspace,r=e.getSvgRoot();if(!r)throw Error("originBlock is not rendered.");let o=this.workspace_.scale;const s=this.workspace_.getSvgXY(r),i=s.x;s.x+=i/t.scale-i;const a=s.y;o=t.scale,s.y+=a/o-a;const l=n.Xml.blockToDom(e),c=n.Xml.domToBlock(l,t),u=c.getSvgRoot();if(!u)throw Error("block is not rendered.");const _=t.getSvgXY(u);return _.x+=t.scrollX/t.scale-t.scrollX,_.y+=t.scrollY/t.scale-t.scrollY,t.toolbox_&&!t.scrollbar&&(_.x+=t.toolbox_.getWidth()/t.scale,_.y+=t.toolbox_.getHeight()/t.scale),c.moveBy(s.x-_.x,s.y-_.y),c},D.prototype.shouldHide=!0,D.prototype.hide=function(){this.shouldHide&&(n.Flyout.prototype.hide.call(this),k.openFieldFlydown_=null),this.shouldHide=!0},D.prototype.autoHide=function(){this.hide()},n.Blocks.lexical_variable_get={category:"Variables",helpUrl:n.Msg.LANG_VARIABLES_GET_HELPURL,init:function(){this.setStyle("variable_blocks"),this.fieldVar_=new T(" "),this.fieldVar_.setBlock(this),this.appendDummyInput().appendField(n.Msg.LANG_VARIABLES_GET_TITLE_GET).appendField(this.fieldVar_,"VAR"),this.setOutput(!0,null),this.setTooltip(n.Msg.LANG_VARIABLES_GET_TOOLTIP),this.errors=[{func:i.checkIsInDefinition},{func:i.checkDropDownContainsValidValue,dropDowns:["VAR"]}],this.setOnChange((function(e){this.workspace.getWarningHandler().checkErrors(this)}))},referenceResults:function(e,t,r){const o=this.getChildren().map((function(n){return y.referenceResult(n,e,t,r)}));let s=[],i=[];for(let e=0;e<o.length;e++)s=s.concat(o[e][0]),i=i.concat(o[e][1]);const a=this.getField("VAR").getText(),c=L(a),u=c[0],_=c[1],d=l&&-1==r.indexOf(a)||!l&&-1==r.indexOf(_);if(u!==n.Msg.LANG_VARIABLES_GLOBAL_PREFIX)if(_===e&&d)if(s.push(this),l)for(let e=0;e<r.length;e++){const n=L(r[e]);t===n[0]&&i.push(n[1])}else i=i.concat(r);else!d||l&&t!==u||i.push(_);return[[s,i]]},getDeclaredVars:function(){return[this.getFieldValue("VAR")]},renameLexicalVar:function(e,t,n,r){void 0===n?e===this.getFieldValue("VAR")&&this.setFieldValue(t,"VAR"):n&&n===this.fieldVar_.getText()&&(this.fieldVar_.getOptions(!1),this.fieldVar_.setValue(t),e===t&&this.setFieldValue(t,"VAR"),this.fieldVar_.forceRerender())},renameFree:function(e){const t=L(this.getFieldValue("VAR"));if(t[0]!==n.Msg.LANG_VARIABLES_GLOBAL_PREFIX){const n=t[1],r=e.apply(n);r!==n&&this.renameLexicalVar(n,r)}},freeVariables:function(){const e=L(this.getFieldValue("VAR"));if(e[0]!==n.Msg.LANG_VARIABLES_GLOBAL_PREFIX){const t=e[1];return new m([t])}return new m}},n.Blocks.lexical_variable_set={category:"Variables",helpUrl:n.Msg.LANG_VARIABLES_SET_HELPURL,init:function(){this.setStyle("variable_blocks"),this.fieldVar_=new T(" "),this.fieldVar_.setBlock(this),this.appendValueInput("VALUE").appendField(n.Msg.LANG_VARIABLES_SET_TITLE_SET).appendField(this.fieldVar_,"VAR").appendField(n.Msg.LANG_VARIABLES_SET_TITLE_TO),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(n.Msg.LANG_VARIABLES_SET_TOOLTIP),this.errors=[{func:i.checkIsInDefinition},{func:i.checkDropDownContainsValidValue,dropDowns:["VAR"]}],this.setOnChange((function(e){this.workspace.getWarningHandler().checkErrors(this)}))},referenceResults:n.Blocks.lexical_variable_get.referenceResults,getDeclaredVars:function(){return[this.getFieldValue("VAR")]},renameLexicalVar:n.Blocks.lexical_variable_get.renameLexicalVar,renameFree:function(e){const t=L(this.getFieldValue("VAR"));if(t[0]!==n.Msg.LANG_VARIABLES_GLOBAL_PREFIX){const n=t[1],r=e.apply(n);r!==n&&this.renameLexicalVar(n,r)}this.getChildren().map((function(t){y.renameFree(t,e)}))},freeVariables:function(){const e=this.getChildren().map((function(e){return y.freeVariables(e)})),t=m.unionAll(e),r=L(this.getFieldValue("VAR"));if(r[0]!==n.Msg.LANG_VARIABLES_GLOBAL_PREFIX){const e=r[1];t.insert(e)}return t}};class w extends k{constructor(e,t){super(e,!0,t,y.renameGlobal)}}w.prototype.fieldCSSClassName="blocklyFieldParameter",w.prototype.flyoutCSSClassName="blocklyFieldParameterFlydown",w.prototype.flydownBlocksXML_=function(){const e=n.Msg.LANG_VARIABLES_GLOBAL_PREFIX+" "+this.getText();return'<xml><block type="lexical_variable_get"><title name="VAR">'+e+'</title></block><block type="lexical_variable_set"><title name="VAR">'+e+"</title></block></xml>"},w.fromJson=function(e){const t=n.utils.replaceMessageReferences(e.name);return new w(t)},n.fieldRegistry.register("field_global_flydown",w);class V extends n.FieldDropdown{constructor(...e){super(...e)}}V.prototype.doClassValidation_=function(e){let t=!1;const n=this.getOptions(!0);for(let r,o=0;r=n[o];o++)if(r[1]===e){t=!0;break}return t||this.generatedOptions.push([e,e]),e},V.fromJson=function(e){return new V(e.options,void 0,e)},n.fieldRegistry.register("field_nocheck_dropdown",V);class v extends k{constructor(e,t,n,r){super(e,t,n,(function(e){if(!v.changeHandlerEnabled)return e;const t=y.renameParam.call(this,e);return r&&r.call(this,t),t}))}referencesVariables(){return!0}}v.prototype.fieldCSSClassName="blocklyFieldParameter",v.prototype.flyoutCSSClassName="blocklyFieldParameterFlydown",v.changeHandlerEnabled=!0,v.withChangeHanderDisabled=function(e){const t=v.changeHandlerEnabled;v.changeHandlerEnabled=!1;try{e()}finally{v.changeHandlerEnabled=t}},v.prototype.flydownBlocksXML_=function(){const e=this.getText();return'<xml><block type="lexical_variable_get"><field name="VAR">'+e+'</field></block><block type="lexical_variable_set"><field name="VAR">'+e+"</field></block></xml>"},v.addHorizontalVerticalOption=function(e,t){let r=0;if(e.getParameters&&(r=e.getParameters().length),e.isCollapsed()||r<=0)return;const o={enabled:!0,text:e.horizontalParameters?n.Msg.VERTICAL_PARAMETERS:n.Msg.HORIZONTAL_PARAMETERS,callback:function(){e.setParameterOrientation(!e.horizontalParameters)}};let s=0;for(let e;(e=t[s])&&e.text!=n.Msg.COLLAPSE_BLOCK;s++);t.splice(s,0,o);for(let e,r=0;e=t[r];r++)if(e.text==n.Msg.INLINE_INPUTS){t.splice(r,1);break}},v.fromJson=function(e){const t=n.utils.replaceMessageReferences(e.name);return new v(t,e.is_editable)},n.fieldRegistry.register("field_parameter_flydown",v);class F extends n.FieldTextInput{constructor(e){super(e,S)}setValue(e){const t=this.getValue();if(this.oldName_=t,this.doValueUpdate_(e),super.setValue(e),!this.sourceBlock_||!this.sourceBlock_.isInFlyout){if("string"==typeof(e=this.getValue())&&this.sourceBlock_){const n=this.sourceBlock_.workspace.getProcedureDatabase();n&&(n.getProcedure(this.sourceBlock_.id)?n.renameProcedure(this.sourceBlock_.id,t,e):n.addProcedure(e,this.sourceBlock_))}this.oldName_=void 0}}}F.fromJson=function(e){const t=n.utils.replaceMessageReferences(e.name);return new F(t)},n.fieldRegistry.register("field_procedurename",F);class M extends n.blockRendering.ExternalValueInput{constructor(e,t){super(e,t),this.connectedBlock?this.height=this.connectedBlockHeight:this.height=this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT}}class G extends n.geras.Highlighter{constructor(e){super(e)}drawIndentedInput(e){const t=e.getLastInput();if(this.RTL_){const r=e.height-t.connectionHeight-t.connectionOffsetY;this.steps_+=n.utils.svgPaths.moveTo(t.xPos+this.highlightOffset+t.connectionWidth-1,e.yPos)+n.utils.svgPaths.lineOnAxis("v",t.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)+n.utils.svgPaths.lineOnAxis("v",r)}else this.steps_+=n.utils.svgPaths.moveTo(t.xPos+t.connectionWidth,e.yPos+t.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)+n.utils.svgPaths.moveTo(t.xPos+t.connectionWidth+1,e.yPos+t.height)}}class x extends n.geras.Drawer{constructor(e,t){super(e,t),this.highlighter_=new G(t)}drawOutline_(){this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.getLastInput()instanceof M?this.drawIndentedInput_(t):t.hasJaggedEdge?this.drawJaggedEdge_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}drawIndentedInput_(e){const t=e.getLastInput();this.positionIndentedValueConnection_(e),this.highlighter_.drawIndentedInput(e);const r="function"==typeof t.shape.pathDown?t.shape.pathDown(t.height):t.shape.pathDown;this.outlinePath_+=n.utils.svgPaths.lineOnAxis("H",t.xPos+t.connectionWidth)+n.utils.svgPaths.lineOnAxis("v",t.connectionOffsetY)+r+n.utils.svgPaths.lineOnAxis("v",e.height-t.connectionHeight-t.connectionOffsetY)+n.utils.svgPaths.lineOnAxis("H",t.xPos+t.width)}positionIndentedValueConnection_=function(e){const t=e.getLastInput();if(t.connectionModel){let n=e.xPos+e.statementEdge+e.constants_.TAB_WIDTH;this.info_.RTL&&(n*=-1),t.connectionModel.setOffsetInBlock(n,e.yPos+t.connectionOffsetY)}}}class B extends n.geras.RenderInfo{addInput_(e,t){e instanceof b?(t.elements.push(new M(this.constants_,e)),t.hasStatement=!0):super.addInput_(e,t)}}class U extends n.geras.Renderer{makeRenderInfo_(e){return new B(this,e)}makeDrawer_(e,t){return new x(e,t)}}const W={referenceResults:function(e,t,n){const r=this,o=r.getDeclaredVarFieldNamesAndPrefixes().map((([e,t])=>{if(l){const n=r.getFieldValue(e);return A(t)(n)}return r.getFieldValue(e)})),s=n.concat(o),i=r.inputList.map((o=>y.referenceResult(r.getInputTargetBlock(o.name),e,t,o.name===r.getScopedInputName()?s:n)));return r.nextConnection&&i.push(y.referenceResult(r.getNextBlock(),e,t,n)),i},withLexicalVarsAndPrefix:function(e,t){const n=this;e&&n.getInputTargetBlock(n.getScopedInputName())===e&&n.getDeclaredVarFieldNamesAndPrefixes().forEach((([e,r])=>{const o=n.getFieldValue(e);t(o,r)}))},getDeclaredVars:function(){const e=this;return e.getDeclaredVarFieldNames().map((t=>e.getFieldValue(t)))},blocksInScope:function(){const e=this.getInputTargetBlock(this.getScopedInputName());return e&&[e]||[]},declaredNames:function(){return this.getDeclaredVars()},renameVar:function(e,t){if(this.renameVars)this.renameVars(N.simpleSubstitution(e,t));else{const r=this;r.getDeclaredVarFieldNames().forEach((o=>{n.Names.equals(e,r.getFieldValue(o))&&r.setFieldValue(t,o)}))}},renameBound:function(e,t){const n=this;let r=t;if(n.inputList.forEach((o=>{o.name===n.getScopedInputName()?(n.getDeclaredVarFieldNames().forEach((o=>{const s=n.getFieldValue(o),i=e.apply(s);if(i!==s){n.renameVar(s,i);const e=N.simpleSubstitution(s,i);r=t.extend(e)}else r=t.remove([s])})),y.renameFree(n.getInputTargetBlock(n.getScopedInputName()),r)):y.renameFree(n.getInputTargetBlock(o.name),t)})),n.nextConnection){const e=n.nextConnection.targetBlock();y.renameFree(e,t)}},renameFree:function(e){const t=this,n=y.freeVariables(t.getInputTargetBlock(t.getScopedInputName())),r=new N;t.getDeclaredVarFieldNames().forEach((o=>{const s=t.getFieldValue(o);n.deleteName(s);const i=n.renamed(e);if(i.isMember(s)){const e=T.nameNotIn(s,i.toList()),t=N.simpleSubstitution(s,e);r.extend(t)}})),t.renameBound(r,e)},freeVariables:function(){const e=this,t=y.freeVariables(e.getInputTargetBlock(e.getScopedInputName()));if(e.getDeclaredVarFieldNames().forEach((n=>{t.deleteName(e.getFieldValue(n))})),e.inputList.forEach((n=>{n.name!==e.getScopedInputName()&&t.unite(y.freeVariables(e.getInputTargetBlock(n.name)))})),e.nextConnection){var n=e.nextConnection.targetBlock();t.unite(y.freeVariables(n))}return t}},H={...W,getDeclaredVarFieldNamesAndPrefixes:function(){return this.getDeclaredVarFieldNames().map((e=>[e,void 0]))}},X={...W,getDeclaredVarFieldNames:function(){return this.getDeclaredVarFieldNamesAndPrefixes().map((([e,t])=>e))}};n.Extensions.registerMixin("lexical_variable_scope_mixin",H),n.Extensions.registerMixin("prefixed_lexical_variable_scope_mixin",X);class Y{static init(e){var r;r=`.${e.getRenderer().getClassName()}.${e.getTheme().getClassName()}`,t.textContent=`\n  ${r}  .blocklyFieldParameter>rect {\n    fill: rgb(222, 143, 108);\n    fill-opacity: 1.0;\n    stroke-width: 2;\n    stroke: rgb(231, 175, 150);\n  }\n  ${r} .blocklyFieldParameter>text {\n    stroke-width: 1;\n    fill: #000;\n  }\n  ${r} .blocklyFieldParameter:hover>rect {\n    stroke-width: 2;\n    stroke: rgb(231,175,150);\n    fill: rgb(231,175,150);\n    fill-opacity: 1.0;\n  }\n  /*\n   * [lyn, 10/08/13] Control flydown with the getter/setter blocks.\n   */\n  ${r} .blocklyFieldParameterFlydown {\n    fill: rgb(231,175,150);\n    fill-opacity: 0.8;\n  }\n  /*\n   * [lyn, 10/08/13] Control parameter fields with flydown procedure\n   * caller block.\n   */\n  ${r} .blocklyFieldProcedure>rect {\n    fill: rgb(215,203,218);\n    fill-opacity: 1.0;\n    stroke-width: 0;\n    stroke: #000;\n  }\n  ${r} .blocklyFieldProcedure>text {\n    fill: #000;\n  }\n  ${r} .blocklyFieldProcedure:hover>rect {\n    stroke-width: 2;\n    stroke: #fff;\n    fill: rgb(215,203,218);\n    fill-opacity: 1.0;\n  }\n  /*\n   * [lyn, 10/08/13] Control flydown with the procedure caller block.\n   */\n  ${r} .blocklyFieldProcedureFlydown {\n    fill: rgb(215,203,218);\n    fill-opacity: 0.8;\n  }`;const o=new D(new n.Options({scrollbars:!1,rtl:e.RTL,renderer:e.options.renderer,rendererOverrides:e.options.rendererOverrides,parentWorkspace:e}));e.flydown_=o,n.utils.dom.insertAfter(o.createDom("g"),e.svgBubbleCanvas_),o.init(e),o.autoClose=!0}static Flydown=D;static FieldFlydown=k;static FieldGlobalFlydown=w;static FieldParameterFlydown=v;static lexicalVariableScopeMixin=H;static LexicalVariable=y;static FieldLexicalVariable=T;static FieldProcedureName=F;static FieldNoCheckDropdown=V;static NameSet=m;static Shared=e;static Substitution=N}n.blockRendering.register("geras2_renderer",U)})(),o})()));
//# sourceMappingURL=index.js.map