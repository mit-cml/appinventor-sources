/*! For license information please see index.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],t);else{var o="object"==typeof exports?t(require("blockly/core")):t(e.Blockly);for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}(this,(e=>(()=>{"use strict";var t={573:t=>{t.exports=e}},o={};function r(e){var s=o[e];if(void 0!==s)return s.exports;var i=o[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{r.r(s),r.d(s,{Constants:()=>e,FlyoutCursor:()=>c,FlyoutCursorPluginInfo:()=>u,LineCursor:()=>g,LineCursorPluginInfo:()=>h,Navigation:()=>C,NavigationController:()=>k});var e={};r.r(e),r.d(e,{LOGGING_MSG_TYPE:()=>i,SHORTCUT_NAMES:()=>o,STATE:()=>t});const t={WORKSPACE:"workspace",FLYOUT:"flyout",TOOLBOX:"toolbox"},o={PREVIOUS:"previous",NEXT:"next",IN:"in",OUT:"out",INSERT:"insert",MARK:"mark",DISCONNECT:"disconnect",TOOLBOX:"toolbox",EXIT:"exit",TOGGLE_KEYBOARD_NAV:"toggle_keyboard_nav",COPY:"keyboard_nav_copy",CUT:"keyboard_nav_cut",PASTE:"keyboard_nav_paste",DELETE:"keyboard_nav_delete",MOVE_WS_CURSOR_UP:"workspace_up",MOVE_WS_CURSOR_DOWN:"workspace_down",MOVE_WS_CURSOR_LEFT:"workspace_left",MOVE_WS_CURSOR_RIGHT:"workspace_right"},i={ERROR:"error",WARN:"warn",LOG:"log"};var n=r(573);class c extends n.Cursor{constructor(){super()}next(){const e=this.getCurNode();if(!e)return null;const t=e.next();return t&&this.setCurNode(t),t}in(){return null}prev(){const e=this.getCurNode();if(!e)return null;const t=e.prev();return t&&this.setCurNode(t),t}out(){return null}}const a=n.registry.Type.CURSOR,l="FlyoutCursor";n.registry.register(a,l,c);const u={[a]:l};class g extends n.BasicCursor{constructor(){super()}next(){const e=this.getCurNode();if(!e)return null;let t=this.getNextNode_(e,this.validLineNode);return t&&(t.getType()==n.ASTNode.types.INPUT||t.getType()==n.ASTNode.types.NEXT)&&t.getLocation().targetBlock()&&(t=this.getNextNode_(t,this.validLineNode)),t&&this.setCurNode(t),t}in(){const e=this.getCurNode();if(!e)return null;const t=this.getNextNode_(e,this.validInLineNode);return t&&this.setCurNode(t),t}prev(){const e=this.getCurNode();if(!e)return null;let t=this.getPreviousNode_(e,this.validLineNode);return t&&(t.getType()==n.ASTNode.types.INPUT||t.getType()==n.ASTNode.types.NEXT)&&t.getLocation().targetBlock()&&(t=this.getPreviousNode_(t,this.validLineNode)),t&&this.setCurNode(t),t}out(){const e=this.getCurNode();if(!e)return null;const t=this.getPreviousNode_(e,this.validInLineNode);return t&&this.setCurNode(t),t}validLineNode(e){if(!e)return!1;let t=!1;const o=e.getLocation(),r=e&&e.getType();return r==n.ASTNode.types.BLOCK?null===o.outputConnection&&(t=!0):(r==n.ASTNode.types.INPUT&&o.type==n.NEXT_STATEMENT||r==n.ASTNode.types.NEXT)&&(t=!0),t}validInLineNode(e){if(!e)return!1;let t=!1;const o=e.getLocation(),r=e&&e.getType();return(r==n.ASTNode.types.FIELD||r==n.ASTNode.types.INPUT&&o.type==n.INPUT_VALUE)&&(t=!0),t}}const d="LineCursor",y=n.registry.Type.CURSOR;n.registry.register(y,d,g);const h={[y]:d};class C{constructor(){this.workspaceStates={},this.loggingCallback=null,this.WS_MOVE_DISTANCE=40,this.MARKER_NAME="local_marker_1",this.DEFAULT_WS_COORDINATE=new n.utils.Coordinate(100,100),this.WS_COORDINATE_ON_DELETE=new n.utils.Coordinate(100,100),this.wsChangeWrapper=this.workspaceChangeListener.bind(this),this.flyoutChangeWrapper=this.flyoutChangeListener.bind(this),this.workspaces=[]}addWorkspace(e){this.workspaces.push(e);const t=e.getFlyout();e.getMarkerManager().registerMarker(this.MARKER_NAME,new n.Marker),e.addChangeListener(this.wsChangeWrapper),t&&this.addFlyout(t)}removeWorkspace(e){const t=this.workspaces.indexOf(e),o=e.getFlyout();e.getCursor()&&this.disableKeyboardAccessibility(e),t>-1&&this.workspaces.splice(t,1),e.getMarkerManager()&&e.getMarkerManager().unregisterMarker(this.MARKER_NAME),e.removeChangeListener(this.wsChangeWrapper),o&&this.removeFlyout(o)}setState(e,t){this.workspaceStates[e.id]=t}getState(e){return this.workspaceStates[e.id]}getMarker(e){return e.getMarker(this.MARKER_NAME)}addFlyout(e){const t=e.getWorkspace();t.addChangeListener(this.flyoutChangeWrapper);const o=n.registry.getClass(a,l);t.getMarkerManager().setCursor(new o)}removeFlyout(e){e.getWorkspace().removeChangeListener(this.flyoutChangeWrapper)}workspaceChangeListener(e){const t=n.Workspace.getById(e.workspaceId);if(t&&t.keyboardAccessibilityMode)switch(e.type){case n.Events.DELETE:this.handleBlockDeleteByDrag(t,e);break;case n.Events.BLOCK_CHANGE:"mutation"===e.element&&this.handleBlockMutation(t,e);break;case n.Events.CLICK:this.handleWorkspaceClick(t,e);break;case n.Events.TOOLBOX_ITEM_SELECT:this.handleToolboxCategoryClick(t,e);break;case n.Events.BLOCK_CREATE:this.handleBlockCreate(t,e)}}flyoutChangeListener(e){const t=n.Workspace.getById(e.workspaceId),o=t.targetWorkspace,r=o.getFlyout();if(o&&o.keyboardAccessibilityMode&&!r.autoClose)if(e.type===n.Events.CLICK&&"block"===e.targetType){const r=t.getBlockById(e.blockId);this.handleBlockClickInFlyout(o,r)}else if(e.type===n.Events.SELECTED){const r=t.getBlockById(e.newElementId);this.handleBlockClickInFlyout(o,r)}}handleBlockCreate(e,o){this.getState(e)===t.FLYOUT&&(this.resetFlyout(e,!!e.getToolbox()),this.setState(e,t.WORKSPACE))}handleBlockMutation(e,t){const o=t.blockId,r=e.getCursor();if(r){const e=r.getCurNode(),t=e?e.getSourceBlock():null;t&&t.id===o&&r.setCurNode(n.ASTNode.createBlockNode(t))}}handleWorkspaceClick(e,o){this.getState(e)!==t.WORKSPACE&&(this.resetFlyout(e,!!e.getToolbox()),this.setState(e,t.WORKSPACE))}handleToolboxCategoryClick(e,o){const r=this.getState(e);o.newItem&&r!==t.TOOLBOX?this.focusToolbox(e):o.newItem||(this.resetFlyout(e,!!e.getToolbox()),this.setState(e,t.WORKSPACE))}handleBlockDeleteByDrag(e,t){const o=t.blockId,r=t.ids,s=e.getCursor();if(!s||!s.getCurNode()||!s.getCurNode().getSourceBlock())return;const i=s.getCurNode().getSourceBlock();(i.id===o||r.indexOf(i.id)>-1)&&s.setCurNode(n.ASTNode.createWorkspaceNode(e,this.WS_COORDINATE_ON_DELETE))}handleBlockClickInFlyout(e,o){o&&(o.isShadow()&&(o=o.getParent()),this.getFlyoutCursor(e).setCurNode(n.ASTNode.createStackNode(o)),this.setState(e,t.FLYOUT))}moveCursorOnBlockDelete(e,t){if(!e||!e.getCursor())return;const o=e.getCursor(),r=o.getCurNode(),s=r?r.getSourceBlock():null;if(s===t)if(s.getParent()){const e=s.previousConnection||s.outputConnection;e&&o.setCurNode(n.ASTNode.createConnectionNode(e.targetConnection))}else o.setCurNode(n.ASTNode.createWorkspaceNode(s.workspace,s.getRelativeToSurfaceXY()));else s&&t.getChildren(!1).indexOf(s)>-1&&o.setCurNode(n.ASTNode.createWorkspaceNode(s.workspace,s.getRelativeToSurfaceXY()))}focusToolbox(e){const o=e.getToolbox();if(o&&(this.setState(e,t.TOOLBOX),this.resetFlyout(e,!1),this.getMarker(e).getCurNode()||this.markAtCursor(e),!o.getSelectedItem())){const e=o.getToolboxItems();for(let t,r=0;t=e[r];r++)if(t.isSelectable()){o.selectItemByPosition(r);break}}}focusFlyout(e){const o=e.getFlyout();if(this.setState(e,t.FLYOUT),this.getMarker(e).getCurNode()||this.markAtCursor(e),o&&o.getWorkspace()){const t=o.getWorkspace().getTopBlocks(!0);if(t.length>0){const o=n.ASTNode.createStackNode(t[0]);this.getFlyoutCursor(e).setCurNode(o)}}}focusWorkspace(e){e.hideChaff();const o=!!e.getToolbox();this.resetFlyout(e,o),this.setState(e,t.WORKSPACE),this.setCursorOnWorkspaceFocus(e)}setCursorOnWorkspaceFocus(e){const t=e.getTopBlocks(!0),o=e.getCursor(),r=new n.utils.Coordinate(this.DEFAULT_WS_COORDINATE.x/e.scale,this.DEFAULT_WS_COORDINATE.y/e.scale);if(t.length>0)o.setCurNode(n.ASTNode.createTopNode(t[0]));else{const t=n.ASTNode.createWorkspaceNode(e,r);o.setCurNode(t)}}getFlyoutCursor(e){const t=e.getFlyout();return t?t.getWorkspace().getCursor():null}insertFromFlyout(e){const t=this.createNewBlock(e);if(!t)return;const o=this.getMarker(e).getCurNode();this.tryToConnectMarkerAndCursor(e,o,n.ASTNode.createBlockNode(t))||this.warn("Something went wrong while inserting a block from the flyout."),this.focusWorkspace(e),e.getCursor().setCurNode(n.ASTNode.createTopNode(t)),this.removeMark(e)}createNewBlock(e){const t=e.getFlyout();if(!t||!t.isVisible())return this.warn("Trying to insert from the flyout when the flyout does not  exist or is not visible"),null;const o=this.getFlyoutCursor(e).getCurNode().getLocation();if(!o.isEnabled())return this.warn("Can't insert a disabled block."),null;const r=t.createBlock(o);return r.render(),r.setConnectionTracking(!0),r}resetFlyout(e,t){this.getFlyoutCursor(e)&&(this.getFlyoutCursor(e).hide(),t&&e.getFlyout().hide())}connectMarkerAndCursor(e){const t=this.getMarker(e).getCurNode(),o=e.getCursor().getCurNode();return!(!t||!o)&&this.tryToConnectMarkerAndCursor(e,t,o)}tryToConnectMarkerAndCursor(e,t,o){if(!this.logConnectionWarning(t,o))return!1;const r=t.getType(),s=o.getType(),i=o.getLocation(),c=t.getLocation();if(t.isConnection()&&o.isConnection()){const e=i,t=c;return this.connect(e,t)}if(t.isConnection()&&(s==n.ASTNode.types.BLOCK||s==n.ASTNode.types.STACK)){const e=i,t=c;return this.insertBlock(e,t)}if(r==n.ASTNode.types.WORKSPACE){const e=o?o.getSourceBlock():null;return this.moveBlockToWorkspace(e,t)}return this.warn("Unexpected state in tryToConnectMarkerAndCursor."),!1}logConnectionWarning(e,t){if(!e)return this.warn("Cannot insert with no marked node."),!1;if(!t)return this.warn("Cannot insert with no cursor node."),!1;const o=e.getType(),r=t.getType();return o==n.ASTNode.types.FIELD?(this.warn("Should not have been able to mark a field."),!1):o==n.ASTNode.types.BLOCK?(this.warn("Should not have been able to mark a block."),!1):o==n.ASTNode.types.STACK?(this.warn("Should not have been able to mark a stack."),!1):r==n.ASTNode.types.FIELD?(this.warn("Cannot attach a field to anything else."),!1):r!=n.ASTNode.types.WORKSPACE||(this.warn("Cannot attach a workspace to anything else."),!1)}moveBlockToWorkspace(e,t){return!!e&&(e.isShadow()?(this.warn("Cannot move a shadow block to the workspace."),!1):(e.getParent()&&e.unplug(!1),e.moveTo(t.getWsCoordinate()),!0))}disconnectChild(e,t){const o=e.getSourceBlock(),r=t.getSourceBlock();let s;o.getRootBlock()===r.getRootBlock()&&(o.getDescendants(!1).indexOf(r)>-1?(s=this.getInferiorConnection(t),s&&s.disconnect()):(s=this.getInferiorConnection(e),s&&s.disconnect()))}connect(e,t){if(!e||!t)return!1;const o=this.getInferiorConnection(e),r=this.getSuperiorConnection(t),s=this.getSuperiorConnection(e),i=this.getInferiorConnection(t);if(o&&r&&this.moveAndConnect(o,r))return!0;if(s&&i&&this.moveAndConnect(s,i))return!0;if(this.moveAndConnect(e,t))return!0;{const o=e.getConnectionChecker(),r=o.canConnectWithReason(e,t,!1);return this.warn("Connection failed with error: "+o.getErrorMessage(r,e,t)),!1}}getInferiorConnection(e){const t=e.getSourceBlock();return e.isSuperior()?t.previousConnection?t.previousConnection:t.outputConnection?t.outputConnection:null:e}getSuperiorConnection(e){return e.isSuperior()?e:e.targetConnection?e.targetConnection:null}moveAndConnect(e,t){if(!e||!t)return!1;const o=e.getSourceBlock();if(e.getConnectionChecker().canConnect(e,t,!1)&&!t.getSourceBlock().isShadow()){if(this.disconnectChild(e,t),!t.isSuperior()){const r=o.getRootBlock(),s={x:t.x-e.x,y:t.y-e.y},i=e.getOffsetInBlock().clone();r.positionNearConnection(e,s,i)}return t.connect(e),!0}return!1}insertBlock(e,t){switch(t.type){case n.PREVIOUS_STATEMENT:if(this.connect(e.nextConnection,t))return!0;break;case n.NEXT_STATEMENT:if(this.connect(e.previousConnection,t))return!0;break;case n.INPUT_VALUE:if(this.connect(e.outputConnection,t))return!0;break;case n.OUTPUT_VALUE:for(let o=0;o<e.inputList.length;o++){const r=e.inputList[o].connection;if(r&&r.type===n.INPUT_VALUE&&this.connect(r,t))return!0}if(e.outputConnection&&this.connect(e.outputConnection,t))return!0}return this.warn("This block can not be inserted at the marked location."),!1}disconnectBlocks(e){const t=e.getCursor().getCurNode();if(!t.isConnection())return void this.log("Cannot disconnect blocks when the cursor is not on a connection");const o=t.getLocation();if(!o.isConnected())return void this.log("Cannot disconnect unconnected connection");const r=o.isSuperior()?o:o.targetConnection,s=o.isSuperior()?o.targetConnection:o;if(s.getSourceBlock().isShadow())return void this.log("Cannot disconnect a shadow block");r.disconnect(),s.bumpAwayFrom(r),r.getSourceBlock().getRootBlock().bringToFront();const i=n.ASTNode.createConnectionNode(r);e.getCursor().setCurNode(i)}markAtCursor(e){this.getMarker(e).setCurNode(e.getCursor().getCurNode())}removeMark(e){const t=this.getMarker(e);t.setCurNode(null),t.hide()}enableKeyboardAccessibility(e){this.workspaces.indexOf(e)>-1&&!e.keyboardAccessibilityMode&&(e.keyboardAccessibilityMode=!0,this.focusWorkspace(e))}disableKeyboardAccessibility(e){this.workspaces.indexOf(e)>-1&&e.keyboardAccessibilityMode&&(e.keyboardAccessibilityMode=!1,e.getCursor().hide(),this.getMarker(e).hide(),this.getFlyoutCursor(e)&&this.getFlyoutCursor(e).hide())}log(e){this.loggingCallback?this.loggingCallback(i.LOG,e):console.log(e)}warn(e){this.loggingCallback?this.loggingCallback(i.WARN,e):console.warn(e)}error(e){this.loggingCallback?this.loggingCallback(i.ERROR,e):console.error(e)}moveWSCursor(e,t,o){const r=e.getCursor(),s=e.getCursor().getCurNode();if(s.getType()!==n.ASTNode.types.WORKSPACE)return!1;const i=s.getWsCoordinate(),c=t*this.WS_MOVE_DISTANCE+i.x,a=o*this.WS_MOVE_DISTANCE+i.y;return r.setCurNode(n.ASTNode.createWorkspaceNode(e,new n.utils.Coordinate(c,a))),!0}handleEnterForWS(e){const t=e.getCursor().getCurNode(),o=t.getType();o==n.ASTNode.types.FIELD?t.getLocation().showEditor():t.isConnection()||o==n.ASTNode.types.WORKSPACE?this.markAtCursor(e):o==n.ASTNode.types.BLOCK?this.warn("Cannot mark a block."):o==n.ASTNode.types.STACK&&this.warn("Cannot mark a stack.")}paste(e,t){let o=!1;n.Events.setGroup(!0);const r=n.clipboard.paste(e,t);return r&&(o=this.insertPastedBlock(t,r)),n.Events.setGroup(!1),o}insertPastedBlock(e,t){let o=!1;const r=e.getMarker(this.MARKER_NAME).getCurNode();return r&&(o=this.tryToConnectMarkerAndCursor(e,r,n.ASTNode.createBlockNode(t))),o}dispose(){for(const e of this.workspaces)this.removeWorkspace(e)}}const p=n.Gesture.prototype.doWorkspaceClick_;n.Gesture.prototype.doWorkspaceClick_=function(e){p.call(this,e);const t=this.creatorWorkspace_;if(e.shiftKey&&t.keyboardAccessibilityMode){const o=new n.utils.Coordinate(e.clientX,e.clientY),r=n.utils.svgMath.screenToWsCoordinates(t,o),s=n.ASTNode.createWorkspaceNode(t,r);t.getCursor().setCurNode(s)}};const S=n.Gesture.prototype.doBlockClick_;n.Gesture.prototype.doBlockClick_=function(e){S.call(this,e),!this.targetBlock_.isInFlyout&&this.mostRecentEvent_.shiftKey&&this.targetBlock_.workspace.keyboardAccessibilityMode&&this.creatorWorkspace_.getCursor().setCurNode(n.ASTNode.createTopNode(this.targetBlock_))};class k{copyData=null;copyWorkspace=null;constructor(e){this.navigation=e||new C}init(){this.addShortcutHandlers(),this.registerDefaults()}addShortcutHandlers(){n.FieldColour&&(n.FieldColour.prototype.onShortcut=this.fieldColourHandler),n.FieldDropdown&&(n.FieldDropdown.prototype.onShortcut=this.fieldDropdownHandler),n.Toolbox&&(n.Toolbox.prototype.onShortcut=this.toolboxHandler)}removeShortcutHandlers(){n.FieldColour&&(n.FieldColour.prototype.onShortcut=null),n.FieldDropdown&&(n.FieldDropdown.prototype.onShortcut=null),n.Toolbox&&(n.Toolbox.prototype.onShortcut=null)}fieldColourHandler(e){if(this.picker_)switch(e.name){case o.PREVIOUS:return this.moveHighlightBy_(0,-1),!0;case o.NEXT:return this.moveHighlightBy_(0,1),!0;case o.OUT:return this.moveHighlightBy_(-1,0),!0;case o.IN:return this.moveHighlightBy_(1,0),!0;default:return!1}return n.Field.prototype.onShortcut.call(this,e)}fieldDropdownHandler(e){if(this.menu_)switch(e.name){case o.PREVIOUS:return this.menu_.highlightPrevious(),!0;case o.NEXT:return this.menu_.highlightNext(),!0;default:return!1}return n.Field.prototype.onShortcut.call(this,e)}toolboxHandler(e){if(!this.selectedItem_)return!1;switch(e.name){case o.PREVIOUS:return this.selectPrevious_();case o.OUT:return this.selectParent_();case o.NEXT:return this.selectNext_();case o.IN:return this.selectChild_();default:return!1}}addWorkspace(e){this.navigation.addWorkspace(e)}removeWorkspace(e){this.navigation.removeWorkspace(e)}enable(e){this.navigation.enableKeyboardAccessibility(e)}disable(e){this.navigation.disableKeyboardAccessibility(e)}fieldShortcutHandler(e,t){const o=e.getCursor();if(!o||!o.getCurNode())return!1;const r=o.getCurNode();return r.getType()===n.ASTNode.types.FIELD&&r.getLocation().onShortcut(t)}registerPrevious(){const e={name:o.PREVIOUS,preconditionFn:e=>e.keyboardAccessibilityMode,callback:(e,o,r)=>{const s=e.getFlyout(),i=e.getToolbox();let n=!1;switch(this.navigation.getState(e)){case t.WORKSPACE:return n=this.fieldShortcutHandler(e,r),n||(e.getCursor().prev(),n=!0),n;case t.FLYOUT:return n=this.fieldShortcutHandler(e,r),n||(s.getWorkspace().getCursor().prev(),n=!0),n;case t.TOOLBOX:return!(!i||"function"!=typeof i.onShortcut)&&i.onShortcut(r);default:return!1}}};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.W,e.name)}registerToggleKeyboardNav(){const e={name:o.TOGGLE_KEYBOARD_NAV,callback:e=>(e.keyboardAccessibilityMode?this.navigation.disableKeyboardAccessibility(e):this.navigation.enableKeyboardAccessibility(e),!0)};n.ShortcutRegistry.registry.register(e);const t=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.K,[n.utils.KeyCodes.CTRL,n.utils.KeyCodes.SHIFT]);n.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerOut(){const e={name:o.OUT,preconditionFn:e=>e.keyboardAccessibilityMode,callback:(e,o,r)=>{const s=e.getToolbox();let i=!1;switch(this.navigation.getState(e)){case t.WORKSPACE:return i=this.fieldShortcutHandler(e,r),i||(e.getCursor().out(),i=!0),i;case t.FLYOUT:return this.navigation.focusToolbox(e),!0;case t.TOOLBOX:return!(!s||"function"!=typeof s.onShortcut)&&s.onShortcut(r);default:return!1}}};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.A,e.name)}registerNext(){const e={name:o.NEXT,preconditionFn:e=>e.keyboardAccessibilityMode,callback:(e,o,r)=>{const s=e.getToolbox(),i=e.getFlyout();let n=!1;switch(this.navigation.getState(e)){case t.WORKSPACE:return n=this.fieldShortcutHandler(e,r),n||(e.getCursor().next(),n=!0),n;case t.FLYOUT:return n=this.fieldShortcutHandler(e,r),n||(i.getWorkspace().getCursor().next(),n=!0),n;case t.TOOLBOX:return!(!s||"function"!=typeof s.onShortcut)&&s.onShortcut(r);default:return!1}}};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.S,e.name)}registerIn(){const e={name:o.IN,preconditionFn:e=>e.keyboardAccessibilityMode,callback:(e,o,r)=>{const s=e.getToolbox();let i=!1;switch(this.navigation.getState(e)){case t.WORKSPACE:return i=this.fieldShortcutHandler(e,r),i||(e.getCursor().in(),i=!0),i;case t.TOOLBOX:return i=!(!s||"function"!=typeof s.onShortcut)&&s.onShortcut(r),i||this.navigation.focusFlyout(e),!0;default:return!1}}};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.D,e.name)}registerInsert(){const e={name:o.INSERT,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.getState(e)===t.WORKSPACE&&this.navigation.connectMarkerAndCursor(e)};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.I,e.name)}registerMark(){const e={name:o.MARK,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>{switch(this.navigation.getState(e)){case t.WORKSPACE:return this.navigation.handleEnterForWS(e),!0;case t.FLYOUT:return this.navigation.insertFromFlyout(e),!0;default:return!1}}};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.ENTER,e.name)}registerDisconnect(){const e={name:o.DISCONNECT,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.getState(e)===t.WORKSPACE&&(this.navigation.disconnectBlocks(e),!0)};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.X,e.name)}registerToolboxFocus(){const e={name:o.TOOLBOX,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.getState(e)===t.WORKSPACE&&(e.getToolbox()?this.navigation.focusToolbox(e):this.navigation.focusFlyout(e),!0)};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.T,e.name)}registerExit(){const e={name:o.EXIT,preconditionFn:e=>e.keyboardAccessibilityMode,callback:e=>{switch(this.navigation.getState(e)){case t.FLYOUT:case t.TOOLBOX:return this.navigation.focusWorkspace(e),!0;default:return!1}}};n.ShortcutRegistry.registry.register(e,!0),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.ESC,e.name,!0),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.E,e.name,!0)}registerWorkspaceMoveLeft(){const e={name:o.MOVE_WS_CURSOR_LEFT,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.moveWSCursor(e,-1,0)};n.ShortcutRegistry.registry.register(e);const t=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.A,[n.utils.KeyCodes.SHIFT]);n.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerWorkspaceMoveRight(){const e={name:o.MOVE_WS_CURSOR_RIGHT,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.moveWSCursor(e,1,0)};n.ShortcutRegistry.registry.register(e);const t=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.D,[n.utils.KeyCodes.SHIFT]);n.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerWorkspaceMoveUp(){const e={name:o.MOVE_WS_CURSOR_UP,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.moveWSCursor(e,0,-1)};n.ShortcutRegistry.registry.register(e);const t=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.W,[n.utils.KeyCodes.SHIFT]);n.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerWorkspaceMoveDown(){const e={name:o.MOVE_WS_CURSOR_DOWN,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.moveWSCursor(e,0,1)};n.ShortcutRegistry.registry.register(e);const t=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.S,[n.utils.KeyCodes.SHIFT]);n.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerCopy(){const e={name:o.COPY,preconditionFn:e=>{if(e.keyboardAccessibilityMode&&!e.options.readOnly){const t=e.getCursor().getCurNode();if(t&&t.getSourceBlock()){const e=t.getSourceBlock();return!n.Gesture.inProgress()&&e&&e.isDeletable()&&e.isMovable()}}return!1},callback:e=>{const t=e.getCursor().getCurNode().getSourceBlock();return e.hideChaff(),this.copyData=t.toCopyData(),this.copyWorkspace=t.workspace,!!this.copyData}};n.ShortcutRegistry.registry.register(e);const t=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.C,[n.utils.KeyCodes.CTRL]);n.ShortcutRegistry.registry.addKeyMapping(t,e.name,!0);const r=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.C,[n.utils.KeyCodes.ALT]);n.ShortcutRegistry.registry.addKeyMapping(r,e.name,!0);const s=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.C,[n.utils.KeyCodes.META]);n.ShortcutRegistry.registry.addKeyMapping(s,e.name,!0)}registerPaste(){const e={name:o.PASTE,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly&&!n.Gesture.inProgress(),callback:()=>!(!this.copyData||!this.copyWorkspace)&&this.navigation.paste(this.copyData,this.copyWorkspace)};n.ShortcutRegistry.registry.register(e);const t=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.V,[n.utils.KeyCodes.CTRL]);n.ShortcutRegistry.registry.addKeyMapping(t,e.name,!0);const r=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.V,[n.utils.KeyCodes.ALT]);n.ShortcutRegistry.registry.addKeyMapping(r,e.name,!0);const s=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.V,[n.utils.KeyCodes.META]);n.ShortcutRegistry.registry.addKeyMapping(s,e.name,!0)}registerCut(){const e={name:o.CUT,preconditionFn:e=>{if(e.keyboardAccessibilityMode&&!e.options.readOnly){const t=e.getCursor().getCurNode();if(t&&t.getSourceBlock()){const e=t.getSourceBlock();return!n.Gesture.inProgress()&&e&&e.isDeletable()&&e.isMovable()&&!e.workspace.isFlyout}}return!1},callback:e=>{const t=e.getCursor().getCurNode().getSourceBlock();return this.copyData=t.toCopyData(),this.copyWorkspace=t.workspace,this.navigation.moveCursorOnBlockDelete(e,t),t.checkAndDelete(),!0}};n.ShortcutRegistry.registry.register(e);const t=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.X,[n.utils.KeyCodes.CTRL]);n.ShortcutRegistry.registry.addKeyMapping(t,e.name,!0);const r=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.X,[n.utils.KeyCodes.ALT]);n.ShortcutRegistry.registry.addKeyMapping(r,e.name,!0);const s=n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.X,[n.utils.KeyCodes.META]);n.ShortcutRegistry.registry.addKeyMapping(s,e.name,!0)}registerDelete(){const e={name:o.DELETE,preconditionFn:function(e){if(e.keyboardAccessibilityMode&&!e.options.readOnly){const t=e.getCursor().getCurNode();if(t&&t.getSourceBlock()){const e=t.getSourceBlock();return e&&e.isDeletable()}}return!1},callback:(e,t)=>{const o=e.getCursor().getCurNode().getSourceBlock();return t.preventDefault(),!n.Gesture.inProgress()&&(this.navigation.moveCursorOnBlockDelete(e,o),o.checkAndDelete(),!0)}};n.ShortcutRegistry.registry.register(e),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.DELETE,e.name,!0),n.ShortcutRegistry.registry.addKeyMapping(n.utils.KeyCodes.BACKSPACE,e.name,!0)}registerDefaults(){this.registerPrevious(),this.registerNext(),this.registerIn(),this.registerOut(),this.registerDisconnect(),this.registerExit(),this.registerInsert(),this.registerMark(),this.registerToolboxFocus(),this.registerToggleKeyboardNav(),this.registerWorkspaceMoveDown(),this.registerWorkspaceMoveLeft(),this.registerWorkspaceMoveUp(),this.registerWorkspaceMoveRight(),this.registerCopy(),this.registerPaste(),this.registerCut(),this.registerDelete()}dispose(){const e=Object.values(o);for(const t of e)n.ShortcutRegistry.registry.unregister(t);this.removeShortcutHandlers(),this.navigation.dispose()}}})(),s})()));
//# sourceMappingURL=index.js.map