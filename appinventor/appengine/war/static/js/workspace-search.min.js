/*! For license information please see workspace-search.min.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],e);else{var s="object"==typeof exports?e(require("blockly/core")):e(t.Blockly);for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(this,(t=>(()=>{"use strict";var e={573:e=>{e.exports=t}},s={};function i(t){var o=s[t];if(void 0!==o)return o.exports;var n=s[t]={exports:{}};return e[t](n,n.exports,i),n.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{i.r(o),i.d(o,{WorkspaceSearch:()=>l});const t=["path.blocklyPath.blockly-ws-search-highlight {","fill: #000;","}","path.blocklyPath.blockly-ws-search-highlight.blockly-ws-search-current {","fill: grey;","}",".blockly-ws-search-close-btn {","background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=) no-repeat top left;","}",".blockly-ws-search-next-btn {","background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSA4LjU5TDEyIDEzLjE3bDQuNTktNC41OEwxOCAxMGwtNiA2LTYtNiAxLjQxLTEuNDF6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PC9zdmc+) no-repeat top left;","}",".blockly-ws-search-previous-btn {","background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSAxNS40MUwxMiAxMC44M2w0LjU5IDQuNThMMTggMTRsLTYtNi02IDZ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==) no-repeat top left;","}",".blockly-ws-search {","background: #fff;","border: solid lightgrey 0.5px;","box-shadow: 0px 10px 20px grey;","justify-content: center;","padding: 0.25em;","position: absolute;","z-index: 70;","}",".blockly-ws-search-input input {","border: none;","}",".blockly-ws-search button {","border: none;","}",".blockly-ws-search-actions {","display: flex;","}",".blockly-ws-search-container {","display: flex;","}",".blockly-ws-search-content {","display: flex;","}"],e=function(){let e=!1;return function(){if(e)return;e=!0;const s=t.join("\n"),i=document.createElement("style");i.id="blockly-ws-search-style";const o=document.createTextNode(s);i.appendChild(o),document.head.insertBefore(i,document.head.firstChild)}}();var s=i(573);const n={kind:"categoryToolbox",contents:[{kind:"category",name:"Logic",categorystyle:"logic_category",contents:[{kind:"block",type:"controls_if"},{kind:"block",type:"logic_compare"},{kind:"block",type:"logic_operation"},{kind:"block",type:"logic_negate"},{kind:"block",type:"logic_boolean"},{kind:"block",type:"logic_null"},{kind:"block",type:"logic_ternary"}]},{kind:"category",name:"Loops",categorystyle:"loop_category",contents:[{kind:"block",type:"controls_repeat_ext",inputs:{TIMES:{shadow:{type:"math_number",fields:{NUM:10}}}}},{kind:"block",type:"controls_whileUntil"},{kind:"block",type:"controls_for",inputs:{FROM:{shadow:{type:"math_number",fields:{NUM:1}}},TO:{shadow:{type:"math_number",fields:{NUM:10}}},BY:{shadow:{type:"math_number",fields:{NUM:1}}}}},{kind:"block",type:"controls_forEach"},{kind:"block",type:"controls_flow_statements"}]},{kind:"category",name:"Math",categorystyle:"math_category",contents:[{kind:"block",type:"math_number",fields:{NUM:123}},{kind:"block",type:"math_arithmetic",inputs:{A:{shadow:{type:"math_number",fields:{NUM:1}}},B:{shadow:{type:"math_number",fields:{NUM:1}}}}},{kind:"block",type:"math_single",inputs:{NUM:{shadow:{type:"math_number",fields:{NUM:9}}}}},{kind:"block",type:"math_trig",inputs:{NUM:{shadow:{type:"math_number",fields:{NUM:45}}}}},{kind:"block",type:"math_constant"},{kind:"block",type:"math_number_property",inputs:{NUMBER_TO_CHECK:{shadow:{type:"math_number",fields:{NUM:0}}}}},{kind:"block",type:"math_round",fields:{OP:"ROUND"},inputs:{NUM:{shadow:{type:"math_number",fields:{NUM:3.1}}}}},{kind:"block",type:"math_on_list",fields:{OP:"SUM"}},{kind:"block",type:"math_modulo",inputs:{DIVIDEND:{shadow:{type:"math_number",fields:{NUM:64}}},DIVISOR:{shadow:{type:"math_number",fields:{NUM:10}}}}},{kind:"block",type:"math_constrain",inputs:{VALUE:{shadow:{type:"math_number",fields:{NUM:50}}},LOW:{shadow:{type:"math_number",fields:{NUM:1}}},HIGH:{shadow:{type:"math_number",fields:{NUM:100}}}}},{kind:"block",type:"math_random_int",inputs:{FROM:{shadow:{type:"math_number",fields:{NUM:1}}},TO:{shadow:{type:"math_number",fields:{NUM:100}}}}},{kind:"block",type:"math_random_float"},{kind:"block",type:"math_atan2",inputs:{X:{shadow:{type:"math_number",fields:{NUM:1}}},Y:{shadow:{type:"math_number",fields:{NUM:1}}}}}]},{kind:"category",name:"Text",categorystyle:"text_category",contents:[{kind:"block",type:"text"},{kind:"block",type:"text_multiline"},{kind:"block",type:"text_join"},{kind:"block",type:"text_append",inputs:{TEXT:{shadow:{type:"text",fields:{TEXT:""}}}}},{kind:"block",type:"text_length",inputs:{VALUE:{shadow:{type:"text",fields:{TEXT:"abc"}}}}},{kind:"block",type:"text_isEmpty",inputs:{VALUE:{shadow:{type:"text",fields:{TEXT:""}}}}},{kind:"block",type:"text_indexOf",inputs:{VALUE:{block:{type:"variables_get"}},FIND:{shadow:{type:"text",fields:{TEXT:"abc"}}}}},{kind:"block",type:"text_charAt",inputs:{VALUE:{block:{type:"variables_get"}}}},{kind:"block",type:"text_getSubstring",inputs:{STRING:{block:{type:"variables_get"}}}},{kind:"block",type:"text_changeCase",inputs:{TEXT:{shadow:{type:"text",fields:{TEXT:"abc"}}}}},{kind:"block",type:"text_trim",inputs:{TEXT:{shadow:{type:"text",fields:{TEXT:"abc"}}}}},{kind:"block",type:"text_count",inputs:{SUB:{shadow:{type:"text"}},TEXT:{shadow:{type:"text"}}}},{kind:"block",type:"text_replace",inputs:{FROM:{shadow:{type:"text"}},TO:{shadow:{type:"text"}},TEXT:{shadow:{type:"text"}}}},{kind:"block",type:"text_reverse",inputs:{TEXT:{shadow:{type:"text"}}}},{kind:"block",type:"add_text",inputs:{TEXT:{shadow:{type:"text",fields:{TEXT:"abc"}}},COLOR:{shadow:{type:"colour_picker",fields:{COLOUR:"#aa00cc"}}}}}]},{kind:"category",name:"Lists",categorystyle:"list_category",contents:[{kind:"block",type:"lists_create_with"},{kind:"block",type:"lists_create_with"},{kind:"block",type:"lists_repeat",inputs:{NUM:{shadow:{type:"math_number",fields:{NUM:5}}}}},{kind:"block",type:"lists_length"},{kind:"block",type:"lists_isEmpty"},{kind:"block",type:"lists_indexOf",inputs:{VALUE:{block:{type:"variables_get"}}}},{kind:"block",type:"lists_getIndex",inputs:{VALUE:{block:{type:"variables_get"}}}},{kind:"block",type:"lists_setIndex",inputs:{LIST:{block:{type:"variables_get"}}}},{kind:"block",type:"lists_getSublist",inputs:{LIST:{block:{type:"variables_get"}}}},{kind:"block",type:"lists_split",inputs:{DELIM:{shadow:{type:"text",fields:{TEXT:","}}}}},{kind:"block",type:"lists_sort"},{kind:"block",type:"lists_reverse"}]},{kind:"category",name:"Colour",categorystyle:"colour_category",contents:[{kind:"block",type:"colour_picker"},{kind:"block",type:"colour_random"},{kind:"block",type:"colour_rgb",inputs:{RED:{shadow:{type:"math_number",fields:{NUM:100}}},GREEN:{shadow:{type:"math_number",fields:{NUM:50}}},BLUE:{shadow:{type:"math_number",fields:{NUM:0}}}}},{kind:"block",type:"colour_blend",inputs:{COLOUR1:{shadow:{type:"colour_picker",fields:{COLOUR:"#ff0000"}}},COLOUR2:{shadow:{type:"colour_picker",fields:{COLOUR:"#3333ff"}}},RATIO:{shadow:{type:"math_number",fields:{NUM:.5}}}}}]},{kind:"sep"},{kind:"category",name:"Variables",categorystyle:"variable_category",custom:"VARIABLE"},{kind:"category",name:"Functions",categorystyle:"procedure_category",custom:"PROCEDURE"}]};class l{constructor(t){this.workspace_=t,this.id="workspaceSearch",this.htmlDiv_=null,this.actionDiv_=null,this.inputElement_=null,this.textInputPlaceholder_="hello I am finding",this.blocks_=[],this.currentBlockIndex_=-1,this.searchText_="",this.searchOnInput=!0,this.caseSensitive=!1,this.preserveSelected=!0,this.boundEvents_=[]}getBlockCategories_(){const t=[];for(let e=0;e<n.contents.length;e++)n.contents[e].name&&t.push(n.contents[e].name);return t}createBlockDropdown_(){const t=document.createElement("select");return this.getBlockCategories_().forEach((e=>{const s=document.createElement("option");s.text=e,t.add(s)})),t}createSearchTypeDropdown_(){const t=document.createElement("select"),e=document.createElement("option");e.text="keyword",t.add(e);const s=document.createElement("option");return s.text="block Type",t.add(s),t}searchChange_(t){this.clearBlocks();const e=t.target.value;"keyword"===e?(document.getElementsByClassName("blockly-ws-search-input")[0].style.display="flex",document.getElementsByClassName("blockly-ws-block-select")[0].style.display="none"):"block Type"===e&&(document.getElementsByClassName("blockly-ws-block-select")[0].style.display="flex",document.getElementsByClassName("blockly-ws-search-input")[0].style.display="none")}init(){this.workspace_.getComponentManager().addComponent({component:this,weight:0,capabilities:[s.ComponentManager.Capability.POSITIONABLE]}),e(),this.createDom_(),this.setVisible_(!1),this.getBlockCategories_(),this.workspace_.resize()}dispose(){for(const t of this.boundEvents_)s.browserEvents.unbind(t);this.boundEvents_.length=0,this.htmlDiv_&&(this.htmlDiv_.remove(),this.htmlDiv_=null),this.actionDiv_=null,this.inputElement_=null}createDom_(){const t=this.workspace_.getInjectionDiv();this.addEvent_(t,"keydown",this,(t=>this.onWorkspaceKeyDown_(t))),this.htmlDiv_=document.createElement("div"),s.utils.dom.addClass(this.htmlDiv_,"blockly-ws-search");const e=document.createElement("div");s.utils.dom.addClass(e,"blockly-ws-search-container");const i=document.createElement("div");s.utils.dom.addClass(i,"blockly-ws-search-content"),e.appendChild(i);const o=document.createElement("div");s.utils.dom.addClass(o,"blockly-ws-search-select");const n=this.createSearchTypeDropdown_();this.addEvent_(n,"change",this,(t=>this.searchChange_(t))),o.appendChild(n);const l=document.createElement("div");s.utils.dom.addClass(l,"blockly-ws-search-input"),this.inputElement_=this.createTextInput_(),this.addEvent_(this.inputElement_,"keydown",this,(t=>this.onKeyDown_(t))),this.addEvent_(this.inputElement_,"input",this,(()=>this.onInput_())),this.addEvent_(this.inputElement_,"click",this,(()=>{this.searchAndHighlight(this.searchText_,this.preserveSelected),this.inputElement_.select()})),l.appendChild(this.inputElement_);const c=document.createElement("div");s.utils.dom.addClass(c,"blockly-ws-block-select");const a=this.createBlockDropdown_();this.addEvent_(a,"change",this,(t=>{this.searchAndHighlight(t.target.value,this.preserveSelected,"block"),this.inputElement_.select})),c.appendChild(a),i.appendChild(o),i.appendChild(l),i.appendChild(c),this.actionDiv_=document.createElement("div"),s.utils.dom.addClass(this.actionDiv_,"blockly-ws-search-actions"),i.appendChild(this.actionDiv_);const r=this.createNextBtn_();r&&this.addActionBtn(r,(()=>this.next()));const h=this.createPreviousBtn_();h&&this.addActionBtn(h,(()=>this.previous()));const d=this.createCloseBtn_();d&&(this.addBtnListener_(d,(()=>this.close())),e.appendChild(d)),this.htmlDiv_.appendChild(e),t.insertBefore(this.htmlDiv_,this.workspace_.getParentSvg()),c.style.display="none"}addEvent_(t,e,i,o){const n=s.browserEvents.conditionalBind(t,e,i,o);this.boundEvents_.push(n)}addActionBtn(t,e){this.addBtnListener_(t,e),this.actionDiv_.appendChild(t)}createTextInput_(){const t=document.createElement("input");return t.type="text",t.setAttribute("placeholder",this.textInputPlaceholder_),t}createNextBtn_(){return this.createBtn_("blockly-ws-search-next-btn","Find next")}createPreviousBtn_(){return this.createBtn_("blockly-ws-search-previous-btn","Find previous")}createCloseBtn_(){return this.createBtn_("blockly-ws-search-close-btn","Close search bar")}createBtn_(t,e){const i=document.createElement("button");return s.utils.dom.addClass(i,t),i.setAttribute("aria-label",e),i}addBtnListener_(t,e){this.addEvent_(t,"click",this,e),this.addEvent_(t,"keydown",this,(t=>{"Enter"===t.key?(e(t),t.preventDefault()):"Escape"===t.key&&this.close(),t.stopPropagation()}))}getBoundingRectangle(){return null}position(t,e){this.workspace_.RTL?this.htmlDiv_.style.left=t.absoluteMetrics.left+"px":t.toolboxMetrics.position===s.TOOLBOX_AT_RIGHT?this.htmlDiv_.style.right=t.toolboxMetrics.width+"px":this.htmlDiv_.style.right="0",this.htmlDiv_.style.top=t.absoluteMetrics.top+"px"}onInput_(){if(this.searchOnInput){const t=this.inputElement_.value.trim();t!==this.searchText_&&this.searchAndHighlight(t,this.preserveSelected)}}onKeyDown_(t){if("Escape"===t.key)this.close();else if("Enter"===t.key)if(this.searchOnInput)this.next();else{const t=this.inputElement_.value.trim();t!==this.searchText_&&this.searchAndHighlight(t,this.preserveSelected)}}onWorkspaceKeyDown_(t){(t.ctrlKey||t.metaKey)&&"f"===t.key&&(this.open(),t.preventDefault(),t.stopPropagation())}previous(){this.setCurrentBlock_(this.currentBlockIndex_-1)}next(){this.setCurrentBlock_(this.currentBlockIndex_+1)}setSearchPlaceholder(t){this.textInputPlaceholder_=t,this.inputElement_&&this.inputElement_.setAttribute("placeholder",this.textInputPlaceholder_)}setCurrentBlock_(t){if(!this.blocks_.length)return;let e=this.blocks_[this.currentBlockIndex_];e&&this.unhighlightCurrentSelection_(e),this.currentBlockIndex_=(t%this.blocks_.length+this.blocks_.length)%this.blocks_.length,e=this.blocks_[this.currentBlockIndex_],this.highlightCurrentSelection_(e),this.scrollToVisible_(e)}open(){this.setVisible_(!0),this.inputElement_.focus(),this.searchText_&&this.searchAndHighlight(this.searchText_)}close(){this.setVisible_(!1),this.workspace_.markFocused(),this.clearBlocks()}setVisible_(t){this.htmlDiv_.style.display=t?"flex":"none"}searchAndHighlight(t,e,s){const i=this.blocks_[this.currentBlockIndex_];this.searchText_=t.trim(),this.clearBlocks(),this.blocks_=s?this.getMatchingBlockType_(this.workspace_,this.searchText_):this.getMatchingBlocks_(this.workspace_,this.searchText_,this.caseSensitive),this.highlightSearchGroup_(this.blocks_);let o=0;e&&(o=this.blocks_.indexOf(i),o=o>-1?o:0),this.setCurrentBlock_(o)}getSearchPool_(t){return t.getAllBlocks(!0).filter((t=>{const e=t.getSurroundParent();return!e||!e.isCollapsed()}))}isBlockMatch_(t,e,s){let i="";if(t.isCollapsed())i=t.toString();else{const e=[];t.inputList.forEach((t=>{t.fieldRow.forEach((t=>{e.push(t.getText())}))})),i=e.join(" ").trim()}return s||(i=i.toLowerCase()),i.indexOf(e)>-1}getMatchingBlocks_(t,e,s){return e?(this.caseSensitive||(e=e.toLowerCase()),this.getSearchPool_(t).filter((t=>this.isBlockMatch_(t,e,s)))):[]}getMatchingBlockType_(t,e){const s=this.getSearchPool_(t);return e=e.toLowerCase(),s.filter((t=>this.isBlockOfType_(t,e)))}isBlockOfType_(t,e){return{logic_blocks:"logic",loop_blocks:"loops",math_blocks:"math",text_blocks:"text",list_blocks:"lists",colour_blocks:"colour",variable_blocks:"variables",procedure_blocks:"functions"}[t.styleName_]===e}clearBlocks(){this.unhighlightSearchGroup_(this.blocks_);const t=this.blocks_[this.currentBlockIndex_];t&&this.unhighlightCurrentSelection_(t),this.currentBlockIndex_=-1,this.blocks_=[]}highlightCurrentSelection_(t){const e=t.pathObject.svgPath;s.utils.dom.addClass(e,"blockly-ws-search-current")}unhighlightCurrentSelection_(t){const e=t.pathObject.svgPath;s.utils.dom.removeClass(e,"blockly-ws-search-current")}highlightSearchGroup_(t){t.forEach((t=>{const e=t.pathObject.svgPath;s.utils.dom.addClass(e,"blockly-ws-search-highlight")}))}unhighlightSearchGroup_(t){t.forEach((t=>{const e=t.pathObject.svgPath;s.utils.dom.removeClass(e,"blockly-ws-search-highlight")}))}scrollToVisible_(t){if(!this.workspace_.isMovable())return;const e=t.getRelativeToSurfaceXY(),s=this.workspace_.scale,i=t.width*s,o=t.height*s,n=e.y*s,l=(e.y+t.height)*s,c=this.workspace_.RTL?e.x*s-i:e.x*s,a=this.workspace_.RTL?e.x*s:e.x*s+i,r=this.workspace_.getMetrics();let h=r.viewLeft;const d=c<r.viewLeft,p=a>r.viewLeft+r.viewWidth,_=i>r.viewWidth;!_&&d||_&&!this.workspace_.RTL?h=c:(!_&&p||_&&this.workspace_.RTL)&&(h=a-r.viewWidth);let u=r.viewTop;const k=n<r.viewTop,y=l>r.viewTop+r.viewHeight,b=o>r.viewHeight;if(k||b&&y?u=n:y&&(u=l-r.viewHeight),h!==r.viewLeft||u!==r.viewTop){const t=document.activeElement;this.workspace_.scroll(-h,-u),t&&t.focus()}}}})(),o})()));