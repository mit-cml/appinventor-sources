local key = KEYS[1];local toAppend = cjson.decode(ARGV[1]);local project = ARGV[2];local currentValue = redis.call('get', project .. ":" .. key);local newTable;local subTable = {};local subTable1 = {};if (currentValue == false) then newTable = {};else newTable = cjson.decode(currentValue); if not (type(newTable) == 'table') then return error('You can only append to a list'); end end table.insert(newTable, toAppend);local newValue = cjson.encode(newTable);redis.call('set', project .. ":" .. key, newValue);table.insert(subTable1, newValue);table.insert(subTable, key);table.insert(subTable, subTable1);redis.call("publish", project, cjson.encode(subTable));return newValue;